<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiscality - Financial Transparency Platform</title>
    <!-- Firebase v12 CDN -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBVVKhJzO6UtOFH2-7x7x7x7x7x7x7x7x7", // This will be replaced by server
            authDomain: "fiscality-a7952.firebaseapp.com", 
            projectId: "fiscality-a7952",
            storageBucket: "fiscality-a7952.firebasestorage.app",
            messagingSenderId: "885932899890",
            appId: "1:885932899890:web:77fdf2b50e44e8f701862b"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // Make auth functions available globally
        window.firebaseAuth = auth;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.sendEmailVerification = sendEmailVerification;
        
        // Firebase Auth Functions
        window.signup = async function(email, password) {
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Send email verification
                await sendEmailVerification(user);
                
                alert('Account created successfully! Please check your email to verify your account before logging in.');
                return { success: true, user };
            } catch (error) {
                console.error('Signup error:', error);
                alert('Error creating account: ' + error.message);
                return { success: false, error: error.message };
            }
        };
        
        window.login = async function(email, password) {
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                if (!user.emailVerified) {
                    alert('Please verify your email before logging in. Check your email for the verification link.');
                    return { success: false, error: 'Email not verified' };
                }
                
                alert('Login successful! Welcome to Fiscality.');
                return { success: true, user };
            } catch (error) {
                console.error('Login error:', error);
                alert('Error logging in: ' + error.message);
                return { success: false, error: error.message };
            }
        };
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#2563eb',
                        'secondary-blue': '#3b82f6',
                        'success-green': '#10b981'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 50%, #60a5fa 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .popup {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-placeholder {
            background: linear-gradient(45deg, #f3f4f6 25%, transparent 25%), 
                        linear-gradient(-45deg, #f3f4f6 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f3f4f6 75%), 
                        linear-gradient(-45deg, transparent 75%, #f3f4f6 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <h1 class="text-4xl font-bold text-white text-center mb-8">Fiscality</h1>
            <div class="bg-white rounded-2xl card-shadow p-8">
                <div class="space-y-6">
                    <div>
                        <input type="text" id="loginUsername" placeholder="Username" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    </div>
                    <div>
                        <input type="password" id="loginPassword" placeholder="Password" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    </div>
                    <button onclick="handleLogin()" 
                            class="w-full bg-primary-blue hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                        Done
                    </button>
                </div>
                <div class="mt-6 text-center space-y-2">
                    <a href="#" onclick="showSignUp()" class="text-primary-blue hover:underline block">Sign Up</a>
                    <a href="#" onclick="showForgotPassword()" class="text-gray-600 hover:underline block">Forgot Password</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign Up Page -->
    <div id="signUpPage" class="min-h-screen gradient-bg flex items-center justify-center p-4 hidden">
        <div class="w-full max-w-md">
            <h1 class="text-4xl font-bold text-white text-center mb-8">Create an Account</h1>
            <div class="bg-white rounded-2xl card-shadow p-8">
                <div class="space-y-6">
                    <input type="text" id="signupUsername" placeholder="Username" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <input type="password" id="signupPassword" placeholder="Passcode" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <input type="password" id="confirmPassword" placeholder="Confirm Passcode" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <input type="email" id="signupEmail" placeholder="Email" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <button onclick="handleSignUp()" 
                            class="w-full bg-primary-blue hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                        Sign Up
                    </button>
                </div>
                <div class="mt-6 text-center">
                    <a href="#" onclick="showLogin()" class="text-primary-blue hover:underline">Back to Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Who Are You Page -->
    <div id="whoAreYouPage" class="min-h-screen bg-gray-50 p-4 hidden">
        <div class="max-w-4xl mx-auto pt-12">
            <h1 class="text-4xl font-bold text-gray-800 text-center mb-12">Who Are You?</h1>
            <div class="grid md:grid-cols-4 gap-6 mb-12">
                <div onclick="selectUserType('student')" 
                     class="bg-white rounded-2xl card-shadow p-8 text-center cursor-pointer hover:bg-blue-50 transition duration-300 border-2 border-transparent hover:border-primary-blue">
                    <div class="text-6xl mb-4">üéì</div>
                    <h3 class="text-xl font-semibold text-gray-800">Student/Parent</h3>
                </div>
                <div onclick="selectUserType('stakeholder')" 
                     class="bg-white rounded-2xl card-shadow p-8 text-center cursor-pointer hover:bg-blue-50 transition duration-300 border-2 border-transparent hover:border-primary-blue">
                    <div class="text-6xl mb-4">üíº</div>
                    <h3 class="text-xl font-semibold text-gray-800">Stakeholder</h3>
                </div>
                <div onclick="selectUserType('government')" 
                     class="bg-white rounded-2xl card-shadow p-8 text-center cursor-pointer hover:bg-blue-50 transition duration-300 border-2 border-transparent hover:border-primary-blue">
                    <div class="text-6xl mb-4">üèõÔ∏è</div>
                    <h3 class="text-xl font-semibold text-gray-800">Government</h3>
                </div>
                <div onclick="selectUserType('citizens')" 
                     class="bg-white rounded-2xl card-shadow p-8 text-center cursor-pointer hover:bg-blue-50 transition duration-300 border-2 border-transparent hover:border-primary-blue">
                    <div class="text-6xl mb-4">üë•</div>
                    <h3 class="text-xl font-semibold text-gray-800">Citizens</h3>
                </div>
            </div>
            <div class="text-center">
                <button id="userTypeButton" onclick="proceedToVerification()" disabled
                        class="bg-gray-400 text-white font-semibold py-3 px-8 rounded-lg cursor-not-allowed">
                    Done
                </button>
            </div>
        </div>
    </div>

    <!-- Verification Pages -->
    <div id="verificationPage" class="min-h-screen gradient-bg flex items-center justify-center p-4 hidden">
        <div class="w-full max-w-md">
            <h1 class="text-3xl font-bold text-white text-center mb-8">Verification Required</h1>
            <div class="bg-white rounded-2xl card-shadow p-8">
                <div id="verificationFields" class="space-y-6">
                    <!-- Dynamic fields based on user type -->
                </div>
                <button onclick="handleVerification()" 
                        class="w-full bg-primary-blue hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 mt-6">
                    Done
                </button>
            </div>
        </div>
    </div>

    <!-- Student Information Page -->
    <div id="studentInfoPage" class="min-h-screen bg-gray-50 p-4 hidden">
        <div class="max-w-2xl mx-auto pt-12">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-8">Student Profile Setup</h1>
            <div class="bg-white rounded-2xl card-shadow p-8">
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Course</label>
                        <select id="courseSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                            <option value="">Select Course</option>
                            <option value="engineering">Engineering</option>
                            <option value="architecture">Architecture</option>
                            <option value="mca">MCA</option>
                            <option value="mba">MBA</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Specialization</label>
                        <select id="specializationSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                            <option value="">Select Specialization</option>
                            <option value="computer-science">Computer Science</option>
                            <option value="electronics">Electronics</option>
                            <option value="mechanical">Mechanical</option>
                            <option value="civil">Civil</option>
                            <option value="ai-ml">AI/ML</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Clubs (Select multiple)</label>
                        <select id="clubsSelect" multiple class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none h-32">
                            <option value="music">Music Club</option>
                            <option value="debate">Debate Club</option>
                            <option value="robotics">Robotics Club</option>
                            <option value="cultural">Cultural Club</option>
                            <option value="sports">Sports Club</option>
                            <option value="photography">Photography Club</option>
                            <option value="drama">Drama Club</option>
                        </select>
                    </div>
                    <button onclick="completeStudentProfile()" 
                            class="w-full bg-primary-blue hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                        Done
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Pages -->
    <div id="dashboardPage" class="min-h-screen bg-gray-50 hidden">
        <!-- Navigation Header -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <h1 class="text-2xl font-bold text-primary-blue">Fiscality</h1>
                    <div class="flex items-center space-x-4">
                        <input type="text" id="dashboardSearch" placeholder="Search transactions, departments..." 
                               class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none"
                               onkeyup="globalSearch()"
                               onchange="globalSearch()">
                        <button onclick="openSimpleFeedbackModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition duration-300 text-sm">
                            üí≠ Feedback
                        </button>
                        <button onclick="logout()" class="text-gray-600 hover:text-gray-800">Logout</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Dashboard Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div id="dashboardContent">
                <!-- Dynamic content based on user type -->
            </div>
        </div>
    </div>

    <!-- Voting & Forecast Page -->
    <div id="votingPage" class="min-h-screen bg-gray-50 hidden">
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <h1 class="text-2xl font-bold text-primary-blue">Fiscality</h1>
                    <button onclick="showDashboard()" class="text-primary-blue hover:underline">Back to Dashboard</button>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-8">Have Your Say</h2>
            
            <!-- Voting Section -->
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h3 class="text-xl font-semibold mb-4">Increase in Funding</h3>
                    <p class="text-gray-600 mb-4">Vote to increase overall institutional funding</p>
                    <div class="flex items-center justify-between">
                        <span class="text-2xl font-bold text-primary-blue" id="fundingVotes">247</span>
                        <button onclick="vote('funding')" class="bg-primary-blue hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition duration-300">
                            Vote Now
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h3 class="text-xl font-semibold mb-4">Additional Club Funding</h3>
                    <p class="text-gray-600 mb-4">Support increased funding for clubs and departments</p>
                    <div class="flex items-center justify-between">
                        <span class="text-2xl font-bold text-primary-blue" id="clubVotes">189</span>
                        <button onclick="vote('clubs')" class="bg-primary-blue hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition duration-300">
                            Vote Now
                        </button>
                    </div>
                </div>
            </div>

            <!-- Forecast Section -->
            <div class="bg-white rounded-2xl card-shadow p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Financial Forecasting</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Budget Predictions</h3>
                        <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-4xl mb-2">üìä</div>
                                <p class="text-gray-600">Budget Trend Analysis</p>
                                <p class="text-sm text-gray-500">Projected 15% increase next quarter</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Distribution Forecast</h3>
                        <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-4xl mb-2">üìà</div>
                                <p class="text-gray-600">Future Allocations</p>
                                <p class="text-sm text-gray-500">Based on historical data patterns</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Popups -->
    <div id="popup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 popup">
            <div id="popupContent"></div>
            <button onclick="closePopup()" class="mt-4 w-full bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition duration-300">
                Close
            </button>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 popup">
            <h3 class="text-lg font-semibold mb-4">üí≠ Share Your Feedback</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Your Suggestion or Feedback</label>
                    <textarea id="feedbackText" rows="6" placeholder="Tell us what you think! Share suggestions for budget allocation, platform improvements, or any other feedback..." 
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none resize-none"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email (Optional)</label>
                    <input type="email" id="feedbackEmail" placeholder="your.email@example.com" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                </div>
                <div class="flex space-x-3">
                    <button onclick="submitSimpleFeedback()" class="flex-1 bg-primary-blue hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition duration-300">
                        Submit Feedback
                    </button>
                    <button onclick="closeFeedbackModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot -->
    <div id="chatButton" onclick="toggleChat()" class="fixed bottom-6 right-6 bg-primary-blue hover:bg-blue-700 text-white rounded-full p-4 shadow-lg cursor-pointer transition duration-300 z-40">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
    </div>

    <!-- Chat Window -->
    <div id="chatWindow" class="fixed bottom-24 right-6 w-80 bg-white rounded-2xl shadow-2xl border border-gray-200 z-40 hidden">
        <div class="bg-primary-blue text-white p-4 rounded-t-2xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                        <span class="text-sm">ü§ñ</span>
                    </div>
                    <div>
                        <h4 class="font-semibold">Fiscality Assistant</h4>
                        <p class="text-xs opacity-90">Always here to help!</p>
                    </div>
                </div>
                <button onclick="toggleChat()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <div id="chatMessages" class="h-64 overflow-y-auto p-4 space-y-3">
            <div class="flex items-start">
                <div class="w-8 h-8 bg-primary-blue rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                    <span class="text-white text-xs">ü§ñ</span>
                </div>
                <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                    <p class="text-sm">Hi! I'm your Fiscality assistant. I can help you with budget information, transaction searches, voting processes, and more. What would you like to know?</p>
                </div>
            </div>
        </div>
        
        <div class="p-4 border-t border-gray-200">
            <div class="flex space-x-2 mb-3">
                <button onclick="sendQuickMessage('Show me budget breakdown')" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-full text-xs transition duration-300">
                    üí∞ Budget Info
                </button>
                <button onclick="sendQuickMessage('How do I vote?')" class="bg-green-100 hover:bg-green-200 text-green-700 px-3 py-1 rounded-full text-xs transition duration-300">
                    üó≥Ô∏è Voting Help
                </button>
                <button onclick="sendQuickMessage('Search help')" class="bg-purple-100 hover:bg-purple-200 text-purple-700 px-3 py-1 rounded-full text-xs transition duration-300">
                    üîç Search Tips
                </button>
            </div>
            <div class="flex">
                <input type="text" id="chatInput" placeholder="Ask me anything..." 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none text-sm"
                       onkeypress="handleChatKeyPress(event)">
                <button onclick="sendChatMessage()" class="bg-primary-blue hover:bg-blue-700 text-white px-4 py-2 rounded-r-lg transition duration-300">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentUserType = '';
        let verificationCode = '';
        let userVotes = { funding: false, clubs: false, deptFunding: false, clubFunding: false };
        let anomalyDetectionEnabled = false;
        let chatHistory = [];
        let feedbackSubmissions = [];
        let allTransactions = [
            { 
                id: 1, 
                department: 'Computer Science', 
                vendor: 'Dell Technologies', 
                amount: 2500000, 
                date: '2024-01-15', 
                time: '14:30:25',
                description: 'Lab Equipment Purchase', 
                recipient: 'Dr. Rajesh Kumar (HOD CS)',
                approvedBy: 'Prof. Anita Sharma (Principal)',
                paymentMode: 'Bank Transfer',
                status: 'completed',
                purpose: 'New computer lab setup with 50 workstations',
                anomaly: false 
            },
            { 
                id: 2, 
                department: 'Electronics', 
                vendor: 'Siemens Ltd', 
                amount: 1800000, 
                date: '2024-01-20', 
                time: '11:15:42',
                description: 'Circuit Boards and Components', 
                recipient: 'Dr. Priya Mehta (HOD ECE)',
                approvedBy: 'Prof. Anita Sharma (Principal)',
                paymentMode: 'Cheque',
                status: 'completed',
                purpose: 'Advanced electronics lab equipment upgrade',
                anomaly: false 
            },
            { 
                id: 3, 
                department: 'Mechanical', 
                vendor: 'Bosch India', 
                amount: 3200000, 
                date: '2024-01-25', 
                time: '09:45:18',
                description: 'Manufacturing Tools and Machinery', 
                recipient: 'Dr. Suresh Patel (HOD Mech)',
                approvedBy: 'Pending Finance Committee',
                paymentMode: 'Bank Transfer',
                status: 'pending',
                purpose: 'CNC machines and precision tools for workshop',
                anomaly: true 
            },
            { 
                id: 4, 
                department: 'Civil', 
                vendor: 'L&T Construction', 
                amount: 450000, 
                date: '2024-02-01', 
                time: '16:20:33',
                description: 'Survey Equipment', 
                recipient: 'Dr. Kavita Singh (HOD Civil)',
                approvedBy: 'Prof. Anita Sharma (Principal)',
                paymentMode: 'Online Transfer',
                status: 'completed',
                purpose: 'Total station and GPS equipment for surveying lab',
                anomaly: false 
            },
            { 
                id: 5, 
                department: 'Computer Science', 
                vendor: 'Microsoft Corp', 
                amount: 950000, 
                date: '2024-02-05', 
                time: '13:10:55',
                description: 'Software Licenses', 
                recipient: 'Dr. Rajesh Kumar (HOD CS)',
                approvedBy: 'Dr. Amit Verma (Dean)',
                paymentMode: 'Credit Card',
                status: 'completed',
                purpose: 'Visual Studio Enterprise and Office 365 licenses',
                anomaly: false 
            },
            { 
                id: 6, 
                department: 'Electronics', 
                vendor: 'Texas Instruments', 
                amount: 4200000, 
                date: '2024-02-10', 
                time: '10:30:12',
                description: 'Microprocessors and Development Kits', 
                recipient: 'Dr. Priya Mehta (HOD ECE)',
                approvedBy: 'Under Review',
                paymentMode: 'Bank Transfer',
                status: 'pending',
                purpose: 'ARM Cortex processors for embedded systems lab',
                anomaly: true 
            },
            { 
                id: 7, 
                department: 'Mechanical', 
                vendor: 'Tata Steel', 
                amount: 750000, 
                date: '2024-02-15', 
                time: '12:45:28',
                description: 'Raw Materials for Projects', 
                recipient: 'Dr. Suresh Patel (HOD Mech)',
                approvedBy: 'Prof. Anita Sharma (Principal)',
                paymentMode: 'Cheque',
                status: 'completed',
                purpose: 'Steel sheets and rods for student projects',
                anomaly: false 
            },
            { 
                id: 8, 
                department: 'Civil', 
                vendor: 'Godrej & Boyce', 
                amount: 1500000, 
                date: '2024-02-20', 
                time: '15:55:40',
                description: 'Testing Equipment', 
                recipient: 'Dr. Kavita Singh (HOD Civil)',
                approvedBy: 'Prof. Anita Sharma (Principal)',
                paymentMode: 'Online Transfer',
                status: 'completed',
                purpose: 'Concrete testing machine and compression apparatus',
                anomaly: false 
            }
        ];
        let filteredTransactions = [...allTransactions];

        // Currency formatting function for Indian system
        function formatIndianCurrency(amount) {
            if (amount >= 10000000) { // 1 crore and above
                return '‚Çπ' + (amount / 10000000).toFixed(1) + ' Cr';
            } else if (amount >= 100000) { // 1 lakh and above
                return '‚Çπ' + (amount / 100000).toFixed(1) + ' L';
            } else if (amount >= 1000) { // 1 thousand and above
                return '‚Çπ' + (amount / 1000).toFixed(0) + 'K';
            } else {
                return '‚Çπ' + amount.toLocaleString('en-IN');
            }
        }

        function showLogin() {
            hideAllPages();
            document.getElementById('loginPage').classList.remove('hidden');
        }

        function showSignUp() {
            hideAllPages();
            document.getElementById('signUpPage').classList.remove('hidden');
        }

        function showForgotPassword() {
            showPopup(`
                <h3 class="text-lg font-semibold mb-4">Reset Password</h3>
                <input type="email" id="resetEmail" placeholder="Enter your registered email" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4">
                <button onclick="sendResetEmail()" class="w-full bg-primary-blue text-white py-2 px-4 rounded-lg">
                    Send Reset Email
                </button>
            `);
        }

        function sendResetEmail() {
            const email = document.getElementById('resetEmail').value;
            if (email) {
                showPopup(`
                    <div class="text-center">
                        <div class="text-4xl mb-4 text-success-green">‚úì</div>
                        <h3 class="text-lg font-semibold mb-2">Reset Email Sent Successfully</h3>
                        <p class="text-gray-600">Check your email for reset instructions.</p>
                    </div>
                `);
                setTimeout(() => {
                    closePopup();
                    showLogin();
                }, 2000);
            }
        }

        function handleLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (username.length < 5 || password.length < 5) {
                showPopup(`
                    <div class="text-center">
                        <div class="text-4xl mb-4 text-red-500">‚ö†Ô∏è</div>
                        <h3 class="text-lg font-semibold mb-2">Invalid Input</h3>
                        <p class="text-gray-600">Minimum character length required (5 characters)</p>
                    </div>
                `);
                return;
            }

            hideAllPages();
            document.getElementById('whoAreYouPage').classList.remove('hidden');
        }

        function handleSignUp() {
            const username = document.getElementById('signupUsername').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const email = document.getElementById('signupEmail').value;

            if (password !== confirmPassword) {
                showPopup(`
                    <div class="text-center">
                        <div class="text-4xl mb-4 text-red-500">‚ö†Ô∏è</div>
                        <h3 class="text-lg font-semibold mb-2">Password Mismatch</h3>
                        <p class="text-gray-600">Passwords do not match</p>
                    </div>
                `);
                return;
            }

            showPopup(`
                <div class="text-center">
                    <div class="text-4xl mb-4 text-success-green">‚úì</div>
                    <h3 class="text-lg font-semibold mb-2">Account Created Successfully</h3>
                    <p class="text-gray-600">You can now log in with your credentials.</p>
                </div>
            `);
            setTimeout(() => {
                closePopup();
                showLogin();
            }, 2000);
        }

        function selectUserType(type) {
            currentUserType = type;
            document.querySelectorAll('#whoAreYouPage .cursor-pointer').forEach(card => {
                card.classList.remove('border-primary-blue', 'bg-blue-50');
            });
            event.target.closest('.cursor-pointer').classList.add('border-primary-blue', 'bg-blue-50');
            
            const button = document.getElementById('userTypeButton');
            button.disabled = false;
            button.classList.remove('bg-gray-400', 'cursor-not-allowed');
            button.classList.add('bg-primary-blue', 'hover:bg-blue-700', 'cursor-pointer');
        }

        function proceedToVerification() {
            if (!currentUserType) return;

            hideAllPages();
            document.getElementById('verificationPage').classList.remove('hidden');
            
            const fieldsContainer = document.getElementById('verificationFields');
            
            if (currentUserType === 'student') {
                fieldsContainer.innerHTML = `
                    <input type="email" id="collegeEmail" placeholder="College Email" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <input type="password" id="verifyPassword" placeholder="Password" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <div id="codeSection" class="hidden">
                        <input type="text" id="verificationCode" placeholder="Enter verification code" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                        <p class="text-sm text-gray-600 mt-2">Code sent to your Gmail</p>
                    </div>
                `;
            } else if (currentUserType === 'stakeholder') {
                fieldsContainer.innerHTML = `
                    <input type="email" id="stakeholderEmail" placeholder="Email" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <input type="password" id="verifyPassword" placeholder="Password" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <input type="text" id="stakeholderID" placeholder="Stakeholder ID" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <div id="codeSection" class="hidden">
                        <input type="text" id="verificationCode" placeholder="Enter verification code" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                        <p class="text-sm text-gray-600 mt-2">Code sent to your Gmail</p>
                    </div>
                `;
            } else if (currentUserType === 'government') {
                fieldsContainer.innerHTML = `
                    <input type="text" id="governmentID" placeholder="Government ID" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <input type="password" id="govPassword" placeholder="Password (minimum 10 characters)" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                `;
            } else if (currentUserType === 'citizens') {
                fieldsContainer.innerHTML = `
                    <input type="email" id="citizenEmail" placeholder="Email" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                    <input type="password" id="citizenPassword" placeholder="Password" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                `;
            }
            
            // Initialize dashboard features after content is loaded
            setTimeout(() => {
                if (currentUserType === 'student') {
                    displayTransactions();
                    drawCharts();
                } else if (currentUserType === 'citizens') {
                    drawCitizenCharts();
                }
            }, 100);
        }

        function handleVerification() {
            if (currentUserType === 'government') {
                const password = document.getElementById('govPassword').value;
                if (password.length <= 9) {
                    showPopup(`
                        <div class="text-center">
                            <div class="text-4xl mb-4 text-red-500">‚ö†Ô∏è</div>
                            <h3 class="text-lg font-semibold mb-2">Invalid Password Length</h3>
                            <p class="text-gray-600">Password must be more than 9 characters</p>
                        </div>
                    `);
                    return;
                }
                showDashboard();
                return;
            }

            if (currentUserType === 'citizens') {
                const email = document.getElementById('citizenEmail').value;
                const password = document.getElementById('citizenPassword').value;
                if (!email || !password) {
                    showPopup(`
                        <div class="text-center">
                            <div class="text-4xl mb-4 text-red-500">‚ö†Ô∏è</div>
                            <h3 class="text-lg font-semibold mb-2">Missing Information</h3>
                            <p class="text-gray-600">Please enter both email and password</p>
                        </div>
                    `);
                    return;
                }
                showDashboard();
                return;
            }

            const codeSection = document.getElementById('codeSection');
            if (codeSection.classList.contains('hidden')) {
                // First step - send code
                verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
                codeSection.classList.remove('hidden');
                showPopup(`
                    <div class="text-center">
                        <div class="text-4xl mb-4">üìß</div>
                        <h3 class="text-lg font-semibold mb-2">Verification Code Sent</h3>
                        <p class="text-gray-600">Code: ${verificationCode}</p>
                        <p class="text-sm text-gray-500 mt-2">(Demo code for testing)</p>
                    </div>
                `);
            } else {
                // Second step - verify code (accept any non-empty code)
                const enteredCode = document.getElementById('verificationCode').value;
                if (!enteredCode.trim()) {
                    showPopup(`
                        <div class="text-center">
                            <div class="text-4xl mb-4 text-red-500">‚ùå</div>
                            <h3 class="text-lg font-semibold mb-2">Code Required</h3>
                            <p class="text-gray-600">Please enter a verification code</p>
                        </div>
                    `);
                    return;
                }

                if (currentUserType === 'student') {
                    hideAllPages();
                    document.getElementById('studentInfoPage').classList.remove('hidden');
                } else {
                    showDashboard();
                }
            }
        }

        function completeStudentProfile() {
            const course = document.getElementById('courseSelect').value;
            const specialization = document.getElementById('specializationSelect').value;
            const clubs = Array.from(document.getElementById('clubsSelect').selectedOptions).map(option => option.value);

            if (!course || !specialization) {
                showPopup(`
                    <div class="text-center">
                        <div class="text-4xl mb-4 text-red-500">‚ö†Ô∏è</div>
                        <h3 class="text-lg font-semibold mb-2">Incomplete Profile</h3>
                        <p class="text-gray-600">Please select course and specialization</p>
                    </div>
                `);
                return;
            }

            showDashboard();
        }

        function showDashboard() {
            hideAllPages();
            document.getElementById('dashboardPage').classList.remove('hidden');
            
            const content = document.getElementById('dashboardContent');
            
            if (currentUserType === 'student') {
                content.innerHTML = `
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Student Dashboard</h2>
                        <div class="grid md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Department Budget</h3>
                                <p class="text-3xl font-bold text-primary-blue">‚Çπ24 L</p>
                                <p class="text-sm text-gray-600">Computer Science</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Club Allocations</h3>
                                <p class="text-3xl font-bold text-success-green">‚Çπ18 L</p>
                                <p class="text-sm text-gray-600">Your clubs combined</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Funding Progress</h3>
                                <p class="text-3xl font-bold text-orange-500">78%</p>
                                <p class="text-sm text-gray-600">This semester</p>
                            </div>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white rounded-xl card-shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Department Spending</h3>
                            <div class="chart-placeholder h-48 rounded-lg flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üìä</div>
                                    <p class="text-gray-600">CS Department Analytics</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl card-shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Club Budget Breakdown</h3>
                            <div class="chart-placeholder h-48 rounded-lg flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üéØ</div>
                                    <p class="text-gray-600">Your Club Allocations</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Student Voting Section -->
                    <div class="mt-8">
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl card-shadow p-8 border border-purple-200">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-purple-800">üó≥Ô∏è Student Voting Portal</h2>
                                <div class="bg-white px-4 py-2 rounded-full">
                                    <span class="text-sm font-medium text-gray-600">Total Votes: <span class="text-purple-600 font-bold" id="totalVotes">436</span></span>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-8 mb-6">
                                <div class="bg-white rounded-xl p-6 border-2 border-blue-200 hover:border-blue-400 transition-all duration-300 transform hover:scale-105">
                                    <div class="flex items-center mb-4">
                                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                                            <span class="text-2xl">üè´</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-blue-800">Department Funding</h3>
                                            <p class="text-sm text-gray-600">Increase CS department budget</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-700 mb-4">Vote to allocate additional ‚Çπ50 L for new lab equipment, software licenses, and research facilities.</p>
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center">
                                            <span class="text-3xl font-bold text-blue-600" id="deptFundingVotes">247</span>
                                            <span class="text-sm text-gray-500 ml-2">votes</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="bg-blue-100 rounded-full h-2 w-24 mb-1">
                                                <div class="bg-blue-500 h-2 rounded-full" style="width: 57%"></div>
                                            </div>
                                            <span class="text-xs text-gray-500">57% support</span>
                                        </div>
                                    </div>
                                    <button onclick="vote('deptFunding')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                                        üó≥Ô∏è Cast Your Vote
                                    </button>
                                </div>

                                <div class="bg-white rounded-xl p-6 border-2 border-green-200 hover:border-green-400 transition-all duration-300 transform hover:scale-105">
                                    <div class="flex items-center mb-4">
                                        <div class="bg-green-100 p-3 rounded-full mr-4">
                                            <span class="text-2xl">üé≠</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-green-800">Club Funding</h3>
                                            <p class="text-sm text-gray-600">Support student activities</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-700 mb-4">Increase funding for clubs by ‚Çπ25 L to support events, competitions, and student development programs.</p>
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center">
                                            <span class="text-3xl font-bold text-green-600" id="clubFundingVotes">189</span>
                                            <span class="text-sm text-gray-500 ml-2">votes</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="bg-green-100 rounded-full h-2 w-24 mb-1">
                                                <div class="bg-green-500 h-2 rounded-full" style="width: 43%"></div>
                                            </div>
                                            <span class="text-xs text-gray-500">43% support</span>
                                        </div>
                                    </div>
                                    <button onclick="vote('clubFunding')" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                                        üó≥Ô∏è Cast Your Vote
                                    </button>
                                </div>
                            </div>

                            <!-- Voting Results Preview -->
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <h4 class="text-lg font-semibold mb-4 text-gray-800">üìä Live Voting Results</h4>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm font-medium text-gray-700">Department Funding</span>
                                            <span class="text-sm font-bold text-blue-600">57%</span>
                                        </div>
                                        <div class="bg-gray-200 rounded-full h-3">
                                            <div class="bg-blue-500 h-3 rounded-full transition-all duration-500" style="width: 57%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm font-medium text-gray-700">Club Funding</span>
                                            <span class="text-sm font-bold text-green-600">43%</span>
                                        </div>
                                        <div class="bg-gray-200 rounded-full h-3">
                                            <div class="bg-green-500 h-3 rounded-full transition-all duration-500" style="width: 43%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search & Filter Section -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl card-shadow p-8">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">üîé Transaction Search & Filter</h2>
                                <button onclick="toggleAnomalyDetection()" id="anomalyBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300">
                                    ü™´ Enable Anomaly Detection
                                </button>
                            </div>
                            
                            <div class="grid md:grid-cols-3 gap-4 mb-6">
                                <input type="text" id="searchTransactions" placeholder="Search by department or vendor..." 
                                       class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none"
                                       onkeyup="filterTransactions()">
                                <select id="departmentFilter" onchange="filterTransactions()" 
                                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                                    <option value="">All Departments</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Mechanical">Mechanical</option>
                                    <option value="Civil">Civil</option>
                                </select>
                                <select id="amountFilter" onchange="filterTransactions()" 
                                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                                    <option value="">All Amounts</option>
                                    <option value="low">Under ‚Çπ5 L</option>
                                    <option value="medium">‚Çπ5 L - ‚Çπ20 L</option>
                                    <option value="high">Above ‚Çπ20 L</option>
                                </select>
                            </div>

                            <div id="transactionsList" class="space-y-4">
                                <!-- Transactions will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Budget Breakdown Section -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl card-shadow p-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üí∞ Department & Club Budget Breakdown</h2>
                            
                            <div class="grid md:grid-cols-2 gap-8 mb-8">
                                <!-- Department Budget Breakdown -->
                                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                                    <h3 class="text-xl font-bold text-blue-800 mb-4">üè´ Computer Science Department</h3>
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Faculty Salaries</p>
                                                <p class="text-sm text-gray-600">Monthly payments to 12 professors</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ8.5 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Lab Facilities</p>
                                                <p class="text-sm text-gray-600">Equipment, software, maintenance</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ12 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Infrastructure</p>
                                                <p class="text-sm text-gray-600">Classroom upgrades, furniture</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ2.5 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Research & Development</p>
                                                <p class="text-sm text-gray-600">Projects, conferences, publications</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ1 L</span>
                                        </div>
                                        <div class="border-t pt-3 mt-4">
                                            <div class="flex justify-between items-center font-bold text-lg">
                                                <span class="text-blue-800">Total Department Budget</span>
                                                <span class="text-blue-600">‚Çπ24 L</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Club Budget Breakdown -->
                                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                                    <h3 class="text-xl font-bold text-green-800 mb-4">üé≠ Student Clubs & Activities</h3>
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Technical Clubs</p>
                                                <p class="text-sm text-gray-600">Robotics, Coding, AI/ML clubs</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ7 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Cultural Activities</p>
                                                <p class="text-sm text-gray-600">Music, dance, drama, art clubs</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ5 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Sports & Recreation</p>
                                                <p class="text-sm text-gray-600">Equipment, tournaments, coaching</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ4 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Events & Competitions</p>
                                                <p class="text-sm text-gray-600">Annual fest, hackathons, workshops</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ2 L</span>
                                        </div>
                                        <div class="border-t pt-3 mt-4">
                                            <div class="flex justify-between items-center font-bold text-lg">
                                                <span class="text-green-800">Total Club Budget</span>
                                                <span class="text-green-600">‚Çπ18 L</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Visualization Section -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl card-shadow p-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä Budget Visualization & Trends</h2>
                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <h3 class="text-lg font-semibold mb-4">Monthly Spending Pattern</h3>
                                    <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                        <canvas id="spendingChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold mb-4">Department Budget Distribution</h3>
                                    <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                        <canvas id="budgetChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Anomaly Detection Alerts -->
                    <div id="anomalyAlerts" class="mt-8 hidden">
                        <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                            <h2 class="text-xl font-bold text-red-800 mb-4">üö® Anomaly Detection Alerts</h2>
                            <div id="anomalyList" class="space-y-3">
                                <!-- Anomalies will be populated here -->
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentUserType === 'citizens') {
                content.innerHTML = `
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Citizens Dashboard</h2>
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-8 border border-blue-200">
                            <div class="flex items-center mb-4">
                                <span class="text-3xl mr-3">üë•</span>
                                <div>
                                    <h3 class="text-xl font-bold text-blue-800">Public Financial Transparency</h3>
                                    <p class="text-blue-600">Access to institutional financial overview</p>
                                </div>
                            </div>
                            <p class="text-gray-700">As a citizen, you have access to high-level financial information to ensure transparency and accountability in public institutions.</p>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Total Public Budget</h3>
                                <p class="text-3xl font-bold text-primary-blue">‚Çπ2.5 Cr</p>
                                <p class="text-sm text-gray-600">Annual allocation</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Departments Funded</h3>
                                <p class="text-3xl font-bold text-success-green">12</p>
                                <p class="text-sm text-gray-600">Active departments</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Transparency Score</h3>
                                <p class="text-3xl font-bold text-purple-600">95%</p>
                                <p class="text-sm text-gray-600">Public disclosure</p>
                            </div>
                        </div>
                    </div>

                    <!-- Overall Financial Distribution -->
                    <div class="bg-white rounded-xl card-shadow p-8 mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üí∞ Overall Financial Distribution</h2>
                        
                        <div class="grid md:grid-cols-2 gap-8 mb-8">
                            <!-- Major Categories -->
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                                <h3 class="text-xl font-bold text-green-800 mb-4">üè´ Academic Departments</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Engineering Departments</p>
                                            <p class="text-sm text-gray-600">CS, ECE, Mechanical, Civil</p>
                                        </div>
                                        <span class="font-bold text-green-600">‚Çπ1.8 Cr</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Research & Development</p>
                                            <p class="text-sm text-gray-600">Innovation projects, labs</p>
                                        </div>
                                        <span class="font-bold text-green-600">‚Çπ35 L</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Faculty Development</p>
                                            <p class="text-sm text-gray-600">Training, conferences</p>
                                        </div>
                                        <span class="font-bold text-green-600">‚Çπ15 L</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Student Activities -->
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                                <h3 class="text-xl font-bold text-blue-800 mb-4">üéì Student Activities</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Student Clubs</p>
                                            <p class="text-sm text-gray-600">Technical, cultural, sports</p>
                                        </div>
                                        <span class="font-bold text-blue-600">‚Çπ18 L</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Events & Competitions</p>
                                            <p class="text-sm text-gray-600">Annual fest, hackathons</p>
                                        </div>
                                        <span class="font-bold text-blue-600">‚Çπ12 L</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Student Welfare</p>
                                            <p class="text-sm text-gray-600">Scholarships, support</p>
                                        </div>
                                        <span class="font-bold text-blue-600">‚Çπ8 L</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Infrastructure & Operations -->
                        <div class="bg-gradient-to-br from-orange-50 to-yellow-50 rounded-xl p-6 border border-orange-200">
                            <h3 class="text-xl font-bold text-orange-800 mb-4">üèóÔ∏è Infrastructure & Operations</h3>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800">Campus Maintenance</p>
                                        <p class="text-sm text-gray-600">Buildings, utilities</p>
                                    </div>
                                    <span class="font-bold text-orange-600">‚Çπ25 L</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800">Technology Upgrades</p>
                                        <p class="text-sm text-gray-600">IT infrastructure</p>
                                    </div>
                                    <span class="font-bold text-orange-600">‚Çπ20 L</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800">Administrative</p>
                                        <p class="text-sm text-gray-600">Operations, staff</p>
                                    </div>
                                    <span class="font-bold text-orange-600">‚Çπ15 L</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- High-Level Visualization -->
                    <div class="bg-white rounded-xl card-shadow p-8 mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä Budget Overview & Trends</h2>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Annual Budget Distribution</h3>
                                <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                    <canvas id="citizenBudgetChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Quarterly Spending Trends</h3>
                                <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                    <canvas id="citizenTrendChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Public Accountability Section -->
                    <div class="bg-white rounded-xl card-shadow p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üîç Public Accountability</h2>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">‚úÖ</span>
                                    <h4 class="font-semibold text-green-800">Audit Compliance</h4>
                                </div>
                                <p class="text-2xl font-bold text-green-600">98%</p>
                                <p class="text-sm text-gray-600">All financial records audited</p>
                            </div>
                            
                            <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">üìã</span>
                                    <h4 class="font-semibold text-blue-800">Public Reports</h4>
                                </div>
                                <p class="text-2xl font-bold text-blue-600">Monthly</p>
                                <p class="text-sm text-gray-600">Regular financial updates</p>
                            </div>
                            
                            <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">üéØ</span>
                                    <h4 class="font-semibold text-purple-800">Goal Achievement</h4>
                                </div>
                                <p class="text-2xl font-bold text-purple-600">92%</p>
                                <p class="text-sm text-gray-600">Budget targets met</p>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-6">
                            <h4 class="font-semibold mb-4 text-gray-800">üì¢ Recent Public Updates</h4>
                            <div class="space-y-3">
                                <div class="bg-white rounded-lg p-4 border-l-4 border-blue-500">
                                    <p class="font-medium text-gray-800">Q4 Financial Report Published</p>
                                    <p class="text-sm text-gray-600">Complete breakdown of departmental spending and achievements</p>
                                    <p class="text-xs text-gray-500 mt-1">Published 2 days ago</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 border-l-4 border-green-500">
                                    <p class="font-medium text-gray-800">New Infrastructure Projects Approved</p>
                                    <p class="text-sm text-gray-600">‚Çπ45 L allocated for campus modernization and lab upgrades</p>
                                    <p class="text-xs text-gray-500 mt-1">Published 1 week ago</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 border-l-4 border-purple-500">
                                    <p class="font-medium text-gray-800">Student Feedback Integration</p>
                                    <p class="text-sm text-gray-600">Budget adjustments made based on student voting results</p>
                                    <p class="text-xs text-gray-500 mt-1">Published 2 weeks ago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentUserType === 'stakeholder') {
                content.innerHTML = `
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Stakeholder Dashboard</h2>
                        <div class="grid md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Total Investment</h3>
                                <p class="text-3xl font-bold text-primary-blue">‚Çπ45M</p>
                                <p class="text-sm text-success-green">+12% this year</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">ROI</h3>
                                <p class="text-3xl font-bold text-success-green">18.5%</p>
                                <p class="text-sm text-gray-600">Annual return</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Projects Funded</h3>
                                <p class="text-3xl font-bold text-orange-500">24</p>
                                <p class="text-sm text-gray-600">Active projects</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Transparency Score</h3>
                                <p class="text-3xl font-bold text-purple-600">94%</p>
                                <p class="text-sm text-gray-600">Compliance rate</p>
                            </div>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white rounded-xl card-shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Investment Overview</h3>
                            <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üí∞</div>
                                    <p class="text-gray-600">Portfolio Performance</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl card-shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Fund Allocation</h3>
                            <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üìà</div>
                                    <p class="text-gray-600">Distribution Analysis</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Student Voting Section -->
                    <div class="mt-8">
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl card-shadow p-8 border border-purple-200">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-purple-800">üó≥Ô∏è Student Voting Portal</h2>
                                <div class="bg-white px-4 py-2 rounded-full">
                                    <span class="text-sm font-medium text-gray-600">Total Votes: <span class="text-purple-600 font-bold" id="totalVotes">436</span></span>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-8 mb-6">
                                <div class="bg-white rounded-xl p-6 border-2 border-blue-200 hover:border-blue-400 transition-all duration-300 transform hover:scale-105">
                                    <div class="flex items-center mb-4">
                                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                                            <span class="text-2xl">üè´</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-blue-800">Department Funding</h3>
                                            <p class="text-sm text-gray-600">Increase CS department budget</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-700 mb-4">Vote to allocate additional ‚Çπ50 L for new lab equipment, software licenses, and research facilities.</p>
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center">
                                            <span class="text-3xl font-bold text-blue-600" id="deptFundingVotes">247</span>
                                            <span class="text-sm text-gray-500 ml-2">votes</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="bg-blue-100 rounded-full h-2 w-24 mb-1">
                                                <div class="bg-blue-500 h-2 rounded-full" style="width: 57%"></div>
                                            </div>
                                            <span class="text-xs text-gray-500">57% support</span>
                                        </div>
                                    </div>
                                    <button onclick="vote('deptFunding')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                                        üó≥Ô∏è Cast Your Vote
                                    </button>
                                </div>

                                <div class="bg-white rounded-xl p-6 border-2 border-green-200 hover:border-green-400 transition-all duration-300 transform hover:scale-105">
                                    <div class="flex items-center mb-4">
                                        <div class="bg-green-100 p-3 rounded-full mr-4">
                                            <span class="text-2xl">üé≠</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-green-800">Club Funding</h3>
                                            <p class="text-sm text-gray-600">Support student activities</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-700 mb-4">Increase funding for clubs by ‚Çπ25 L to support events, competitions, and student development programs.</p>
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center">
                                            <span class="text-3xl font-bold text-green-600" id="clubFundingVotes">189</span>
                                            <span class="text-sm text-gray-500 ml-2">votes</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="bg-green-100 rounded-full h-2 w-24 mb-1">
                                                <div class="bg-green-500 h-2 rounded-full" style="width: 43%"></div>
                                            </div>
                                            <span class="text-xs text-gray-500">43% support</span>
                                        </div>
                                    </div>
                                    <button onclick="vote('clubFunding')" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                                        üó≥Ô∏è Cast Your Vote
                                    </button>
                                </div>
                            </div>

                            <!-- Voting Results Preview -->
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <h4 class="text-lg font-semibold mb-4 text-gray-800">üìä Live Voting Results</h4>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm font-medium text-gray-700">Department Funding</span>
                                            <span class="text-sm font-bold text-blue-600">57%</span>
                                        </div>
                                        <div class="bg-gray-200 rounded-full h-3">
                                            <div class="bg-blue-500 h-3 rounded-full transition-all duration-500" style="width: 57%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm font-medium text-gray-700">Club Funding</span>
                                            <span class="text-sm font-bold text-green-600">43%</span>
                                        </div>
                                        <div class="bg-gray-200 rounded-full h-3">
                                            <div class="bg-green-500 h-3 rounded-full transition-all duration-500" style="width: 43%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search & Filter Section -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl card-shadow p-8">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">üîé Transaction Search & Filter</h2>
                                <button onclick="toggleAnomalyDetection()" id="anomalyBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300">
                                    ü™´ Enable Anomaly Detection
                                </button>
                            </div>
                            
                            <div class="grid md:grid-cols-3 gap-4 mb-6">
                                <input type="text" id="searchTransactions" placeholder="Search by department or vendor..." 
                                       class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none"
                                       onkeyup="filterTransactions()">
                                <select id="departmentFilter" onchange="filterTransactions()" 
                                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                                    <option value="">All Departments</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Mechanical">Mechanical</option>
                                    <option value="Civil">Civil</option>
                                </select>
                                <select id="amountFilter" onchange="filterTransactions()" 
                                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                                    <option value="">All Amounts</option>
                                    <option value="low">Under ‚Çπ5 L</option>
                                    <option value="medium">‚Çπ5 L - ‚Çπ20 L</option>
                                    <option value="high">Above ‚Çπ20 L</option>
                                </select>
                            </div>

                            <div id="transactionsList" class="space-y-4">
                                <!-- Transactions will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Budget Breakdown Section -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl card-shadow p-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üí∞ Department & Club Budget Breakdown</h2>
                            
                            <div class="grid md:grid-cols-2 gap-8 mb-8">
                                <!-- Department Budget Breakdown -->
                                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                                    <h3 class="text-xl font-bold text-blue-800 mb-4">üè´ Computer Science Department</h3>
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Faculty Salaries</p>
                                                <p class="text-sm text-gray-600">Monthly payments to 12 professors</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ8.5 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Lab Facilities</p>
                                                <p class="text-sm text-gray-600">Equipment, software, maintenance</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ12 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Infrastructure</p>
                                                <p class="text-sm text-gray-600">Classroom upgrades, furniture</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ2.5 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Research & Development</p>
                                                <p class="text-sm text-gray-600">Projects, conferences, publications</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ1 L</span>
                                        </div>
                                        <div class="border-t pt-3 mt-4">
                                            <div class="flex justify-between items-center font-bold text-lg">
                                                <span class="text-blue-800">Total Department Budget</span>
                                                <span class="text-blue-600">‚Çπ24 L</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Club Budget Breakdown -->
                                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                                    <h3 class="text-xl font-bold text-green-800 mb-4">üé≠ Student Clubs & Activities</h3>
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Technical Clubs</p>
                                                <p class="text-sm text-gray-600">Robotics, Coding, AI/ML clubs</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ7 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Cultural Activities</p>
                                                <p class="text-sm text-gray-600">Music, dance, drama, art clubs</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ5 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Sports & Recreation</p>
                                                <p class="text-sm text-gray-600">Equipment, tournaments, coaching</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ4 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Events & Competitions</p>
                                                <p class="text-sm text-gray-600">Annual fest, hackathons, workshops</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ2 L</span>
                                        </div>
                                        <div class="border-t pt-3 mt-4">
                                            <div class="flex justify-between items-center font-bold text-lg">
                                                <span class="text-green-800">Total Club Budget</span>
                                                <span class="text-green-600">‚Çπ18 L</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Visualization Section -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl card-shadow p-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä Budget Visualization & Trends</h2>
                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <h3 class="text-lg font-semibold mb-4">Monthly Spending Pattern</h3>
                                    <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                        <canvas id="spendingChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold mb-4">Department Budget Distribution</h3>
                                    <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                        <canvas id="budgetChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Anomaly Detection Alerts -->
                    <div id="anomalyAlerts" class="mt-8 hidden">
                        <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                            <h2 class="text-xl font-bold text-red-800 mb-4">üö® Anomaly Detection Alerts</h2>
                            <div id="anomalyList" class="space-y-3">
                                <!-- Anomalies will be populated here -->
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentUserType === 'citizens') {
                content.innerHTML = `
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Citizens Dashboard</h2>
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-8 border border-blue-200">
                            <div class="flex items-center mb-4">
                                <span class="text-3xl mr-3">üë•</span>
                                <div>
                                    <h3 class="text-xl font-bold text-blue-800">Public Financial Transparency</h3>
                                    <p class="text-blue-600">Access to institutional financial overview</p>
                                </div>
                            </div>
                            <p class="text-gray-700">As a citizen, you have access to high-level financial information to ensure transparency and accountability in public institutions.</p>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Total Public Budget</h3>
                                <p class="text-3xl font-bold text-primary-blue">‚Çπ2.5 Cr</p>
                                <p class="text-sm text-gray-600">Annual allocation</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Departments Funded</h3>
                                <p class="text-3xl font-bold text-success-green">12</p>
                                <p class="text-sm text-gray-600">Active departments</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Transparency Score</h3>
                                <p class="text-3xl font-bold text-purple-600">95%</p>
                                <p class="text-sm text-gray-600">Public disclosure</p>
                            </div>
                        </div>
                    </div>

                    <!-- Overall Financial Distribution -->
                    <div class="bg-white rounded-xl card-shadow p-8 mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üí∞ Overall Financial Distribution</h2>
                        
                        <div class="grid md:grid-cols-2 gap-8 mb-8">
                            <!-- Major Categories -->
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                                <h3 class="text-xl font-bold text-green-800 mb-4">üè´ Academic Departments</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Engineering Departments</p>
                                            <p class="text-sm text-gray-600">CS, ECE, Mechanical, Civil</p>
                                        </div>
                                        <span class="font-bold text-green-600">‚Çπ1.8 Cr</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Research & Development</p>
                                            <p class="text-sm text-gray-600">Innovation projects, labs</p>
                                        </div>
                                        <span class="font-bold text-green-600">‚Çπ35 L</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Faculty Development</p>
                                            <p class="text-sm text-gray-600">Training, conferences</p>
                                        </div>
                                        <span class="font-bold text-green-600">‚Çπ15 L</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Student Activities -->
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                                <h3 class="text-xl font-bold text-blue-800 mb-4">üéì Student Activities</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Student Clubs</p>
                                            <p class="text-sm text-gray-600">Technical, cultural, sports</p>
                                        </div>
                                        <span class="font-bold text-blue-600">‚Çπ18 L</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Events & Competitions</p>
                                            <p class="text-sm text-gray-600">Annual fest, hackathons</p>
                                        </div>
                                        <span class="font-bold text-blue-600">‚Çπ12 L</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Student Welfare</p>
                                            <p class="text-sm text-gray-600">Scholarships, support</p>
                                        </div>
                                        <span class="font-bold text-blue-600">‚Çπ8 L</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Infrastructure & Operations -->
                        <div class="bg-gradient-to-br from-orange-50 to-yellow-50 rounded-xl p-6 border border-orange-200">
                            <h3 class="text-xl font-bold text-orange-800 mb-4">üèóÔ∏è Infrastructure & Operations</h3>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800">Campus Maintenance</p>
                                        <p class="text-sm text-gray-600">Buildings, utilities</p>
                                    </div>
                                    <span class="font-bold text-orange-600">‚Çπ25 L</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800">Technology Upgrades</p>
                                        <p class="text-sm text-gray-600">IT infrastructure</p>
                                    </div>
                                    <span class="font-bold text-orange-600">‚Çπ20 L</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800">Administrative</p>
                                        <p class="text-sm text-gray-600">Operations, staff</p>
                                    </div>
                                    <span class="font-bold text-orange-600">‚Çπ15 L</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- High-Level Visualization -->
                    <div class="bg-white rounded-xl card-shadow p-8 mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä Budget Overview & Trends</h2>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Annual Budget Distribution</h3>
                                <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                    <canvas id="citizenBudgetChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Quarterly Spending Trends</h3>
                                <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                    <canvas id="citizenTrendChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Public Accountability Section -->
                    <div class="bg-white rounded-xl card-shadow p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üîç Public Accountability</h2>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">‚úÖ</span>
                                    <h4 class="font-semibold text-green-800">Audit Compliance</h4>
                                </div>
                                <p class="text-2xl font-bold text-green-600">98%</p>
                                <p class="text-sm text-gray-600">All financial records audited</p>
                            </div>
                            
                            <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">üìã</span>
                                    <h4 class="font-semibold text-blue-800">Public Reports</h4>
                                </div>
                                <p class="text-2xl font-bold text-blue-600">Monthly</p>
                                <p class="text-sm text-gray-600">Regular financial updates</p>
                            </div>
                            
                            <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">üéØ</span>
                                    <h4 class="font-semibold text-purple-800">Goal Achievement</h4>
                                </div>
                                <p class="text-2xl font-bold text-purple-600">92%</p>
                                <p class="text-sm text-gray-600">Budget targets met</p>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-6">
                            <h4 class="font-semibold mb-4 text-gray-800">üì¢ Recent Public Updates</h4>
                            <div class="space-y-3">
                                <div class="bg-white rounded-lg p-4 border-l-4 border-blue-500">
                                    <p class="font-medium text-gray-800">Q4 Financial Report Published</p>
                                    <p class="text-sm text-gray-600">Complete breakdown of departmental spending and achievements</p>
                                    <p class="text-xs text-gray-500 mt-1">Published 2 days ago</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 border-l-4 border-green-500">
                                    <p class="font-medium text-gray-800">New Infrastructure Projects Approved</p>
                                    <p class="text-sm text-gray-600">‚Çπ45 L allocated for campus modernization and lab upgrades</p>
                                    <p class="text-xs text-gray-500 mt-1">Published 1 week ago</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 border-l-4 border-purple-500">
                                    <p class="font-medium text-gray-800">Student Feedback Integration</p>
                                    <p class="text-sm text-gray-600">Budget adjustments made based on student voting results</p>
                                    <p class="text-xs text-gray-500 mt-1">Published 2 weeks ago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentUserType === 'government') {
                content.innerHTML = `
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Government Dashboard</h2>
                        <div class="grid md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Public Budget</h3>
                                <p class="text-3xl font-bold text-primary-blue">‚Çπ125M</p>
                                <p class="text-sm text-gray-600">Total allocation</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Compliance Rate</h3>
                                <p class="text-3xl font-bold text-success-green">96%</p>
                                <p class="text-sm text-gray-600">Regulatory adherence</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Transparency Index</h3>
                                <p class="text-3xl font-bold text-purple-600">92%</p>
                                <p class="text-sm text-gray-600">Public disclosure</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Audit Score</h3>
                                <p class="text-3xl font-bold text-orange-500">A+</p>
                                <p class="text-sm text-gray-600">Latest assessment</p>
                            </div>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white rounded-xl card-shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Budget Distribution</h3>
                            <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üèõÔ∏è</div>
                                    <p class="text-gray-600">Macro-level Analytics</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl card-shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Public Accountability</h3>
                            <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üìã</div>
                                    <p class="text-gray-600">Governance Metrics</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Student Voting Section -->
                    <div class="mt-8">
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl card-shadow p-8 border border-purple-200">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-purple-800">üó≥Ô∏è Student Voting Portal</h2>
                                <div class="bg-white px-4 py-2 rounded-full">
                                    <span class="text-sm font-medium text-gray-600">Total Votes: <span class="text-purple-600 font-bold" id="totalVotes">436</span></span>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-8 mb-6">
                                <div class="bg-white rounded-xl p-6 border-2 border-blue-200 hover:border-blue-400 transition-all duration-300 transform hover:scale-105">
                                    <div class="flex items-center mb-4">
                                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                                            <span class="text-2xl">üè´</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-blue-800">Department Funding</h3>
                                            <p class="text-sm text-gray-600">Increase CS department budget</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-700 mb-4">Vote to allocate additional ‚Çπ50 L for new lab equipment, software licenses, and research facilities.</p>
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center">
                                            <span class="text-3xl font-bold text-blue-600" id="deptFundingVotes">247</span>
                                            <span class="text-sm text-gray-500 ml-2">votes</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="bg-blue-100 rounded-full h-2 w-24 mb-1">
                                                <div class="bg-blue-500 h-2 rounded-full" style="width: 57%"></div>
                                            </div>
                                            <span class="text-xs text-gray-500">57% support</span>
                                        </div>
                                    </div>
                                    <button onclick="vote('deptFunding')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                                        üó≥Ô∏è Cast Your Vote
                                    </button>
                                </div>

                                <div class="bg-white rounded-xl p-6 border-2 border-green-200 hover:border-green-400 transition-all duration-300 transform hover:scale-105">
                                    <div class="flex items-center mb-4">
                                        <div class="bg-green-100 p-3 rounded-full mr-4">
                                            <span class="text-2xl">üé≠</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-green-800">Club Funding</h3>
                                            <p class="text-sm text-gray-600">Support student activities</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-700 mb-4">Increase funding for clubs by ‚Çπ25 L to support events, competitions, and student development programs.</p>
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center">
                                            <span class="text-3xl font-bold text-green-600" id="clubFundingVotes">189</span>
                                            <span class="text-sm text-gray-500 ml-2">votes</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="bg-green-100 rounded-full h-2 w-24 mb-1">
                                                <div class="bg-green-500 h-2 rounded-full" style="width: 43%"></div>
                                            </div>
                                            <span class="text-xs text-gray-500">43% support</span>
                                        </div>
                                    </div>
                                    <button onclick="vote('clubFunding')" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                                        üó≥Ô∏è Cast Your Vote
                                    </button>
                                </div>
                            </div>

                            <!-- Voting Results Preview -->
                            <div class="bg-white rounded-xl p-6 border border-gray-200">
                                <h4 class="text-lg font-semibold mb-4 text-gray-800">üìä Live Voting Results</h4>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm font-medium text-gray-700">Department Funding</span>
                                            <span class="text-sm font-bold text-blue-600">57%</span>
                                        </div>
                                        <div class="bg-gray-200 rounded-full h-3">
                                            <div class="bg-blue-500 h-3 rounded-full transition-all duration-500" style="width: 57%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm font-medium text-gray-700">Club Funding</span>
                                            <span class="text-sm font-bold text-green-600">43%</span>
                                        </div>
                                        <div class="bg-gray-200 rounded-full h-3">
                                            <div class="bg-green-500 h-3 rounded-full transition-all duration-500" style="width: 43%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search & Filter Section -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl card-shadow p-8">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">üîé Transaction Search & Filter</h2>
                                <button onclick="toggleAnomalyDetection()" id="anomalyBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300">
                                    ü™´ Enable Anomaly Detection
                                </button>
                            </div>
                            
                            <div class="grid md:grid-cols-3 gap-4 mb-6">
                                <input type="text" id="searchTransactions" placeholder="Search by department or vendor..." 
                                       class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none"
                                       onkeyup="filterTransactions()">
                                <select id="departmentFilter" onchange="filterTransactions()" 
                                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                                    <option value="">All Departments</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Mechanical">Mechanical</option>
                                    <option value="Civil">Civil</option>
                                </select>
                                <select id="amountFilter" onchange="filterTransactions()" 
                                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                                    <option value="">All Amounts</option>
                                    <option value="low">Under ‚Çπ5 L</option>
                                    <option value="medium">‚Çπ5 L - ‚Çπ20 L</option>
                                    <option value="high">Above ‚Çπ20 L</option>
                                </select>
                            </div>

                            <div id="transactionsList" class="space-y-4">
                                <!-- Transactions will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Budget Breakdown Section -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl card-shadow p-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üí∞ Department & Club Budget Breakdown</h2>
                            
                            <div class="grid md:grid-cols-2 gap-8 mb-8">
                                <!-- Department Budget Breakdown -->
                                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                                    <h3 class="text-xl font-bold text-blue-800 mb-4">üè´ Computer Science Department</h3>
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Faculty Salaries</p>
                                                <p class="text-sm text-gray-600">Monthly payments to 12 professors</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ8.5 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Lab Facilities</p>
                                                <p class="text-sm text-gray-600">Equipment, software, maintenance</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ12 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Infrastructure</p>
                                                <p class="text-sm text-gray-600">Classroom upgrades, furniture</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ2.5 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Research & Development</p>
                                                <p class="text-sm text-gray-600">Projects, conferences, publications</p>
                                            </div>
                                            <span class="font-bold text-blue-600">‚Çπ1 L</span>
                                        </div>
                                        <div class="border-t pt-3 mt-4">
                                            <div class="flex justify-between items-center font-bold text-lg">
                                                <span class="text-blue-800">Total Department Budget</span>
                                                <span class="text-blue-600">‚Çπ24 L</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Club Budget Breakdown -->
                                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                                    <h3 class="text-xl font-bold text-green-800 mb-4">üé≠ Student Clubs & Activities</h3>
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Technical Clubs</p>
                                                <p class="text-sm text-gray-600">Robotics, Coding, AI/ML clubs</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ7 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Cultural Activities</p>
                                                <p class="text-sm text-gray-600">Music, dance, drama, art clubs</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ5 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Sports & Recreation</p>
                                                <p class="text-sm text-gray-600">Equipment, tournaments, coaching</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ4 L</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-800">Events & Competitions</p>
                                                <p class="text-sm text-gray-600">Annual fest, hackathons, workshops</p>
                                            </div>
                                            <span class="font-bold text-green-600">‚Çπ2 L</span>
                                        </div>
                                        <div class="border-t pt-3 mt-4">
                                            <div class="flex justify-between items-center font-bold text-lg">
                                                <span class="text-green-800">Total Club Budget</span>
                                                <span class="text-green-600">‚Çπ18 L</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Visualization Section -->
                    <div class="mt-8">
                        <div class="bg-white rounded-xl card-shadow p-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä Budget Visualization & Trends</h2>
                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <h3 class="text-lg font-semibold mb-4">Monthly Spending Pattern</h3>
                                    <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                        <canvas id="spendingChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold mb-4">Department Budget Distribution</h3>
                                    <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                        <canvas id="budgetChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Anomaly Detection Alerts -->
                    <div id="anomalyAlerts" class="mt-8 hidden">
                        <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                            <h2 class="text-xl font-bold text-red-800 mb-4">üö® Anomaly Detection Alerts</h2>
                            <div id="anomalyList" class="space-y-3">
                                <!-- Anomalies will be populated here -->
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentUserType === 'citizens') {
                content.innerHTML = `
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Citizens Dashboard</h2>
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-8 border border-blue-200">
                            <div class="flex items-center mb-4">
                                <span class="text-3xl mr-3">üë•</span>
                                <div>
                                    <h3 class="text-xl font-bold text-blue-800">Public Financial Transparency</h3>
                                    <p class="text-blue-600">Access to institutional financial overview</p>
                                </div>
                            </div>
                            <p class="text-gray-700">As a citizen, you have access to high-level financial information to ensure transparency and accountability in public institutions.</p>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Total Public Budget</h3>
                                <p class="text-3xl font-bold text-primary-blue">‚Çπ2.5 Cr</p>
                                <p class="text-sm text-gray-600">Annual allocation</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Departments Funded</h3>
                                <p class="text-3xl font-bold text-success-green">12</p>
                                <p class="text-sm text-gray-600">Active departments</p>
                            </div>
                            <div class="bg-white rounded-xl card-shadow p-6">
                                <h3 class="text-lg font-semibold mb-2">Transparency Score</h3>
                                <p class="text-3xl font-bold text-purple-600">95%</p>
                                <p class="text-sm text-gray-600">Public disclosure</p>
                            </div>
                        </div>
                    </div>

                    <!-- Overall Financial Distribution -->
                    <div class="bg-white rounded-xl card-shadow p-8 mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üí∞ Overall Financial Distribution</h2>
                        
                        <div class="grid md:grid-cols-2 gap-8 mb-8">
                            <!-- Major Categories -->
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                                <h3 class="text-xl font-bold text-green-800 mb-4">üè´ Academic Departments</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Engineering Departments</p>
                                            <p class="text-sm text-gray-600">CS, ECE, Mechanical, Civil</p>
                                        </div>
                                        <span class="font-bold text-green-600">‚Çπ1.8 Cr</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Research & Development</p>
                                            <p class="text-sm text-gray-600">Innovation projects, labs</p>
                                        </div>
                                        <span class="font-bold text-green-600">‚Çπ35 L</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Faculty Development</p>
                                            <p class="text-sm text-gray-600">Training, conferences</p>
                                        </div>
                                        <span class="font-bold text-green-600">‚Çπ15 L</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Student Activities -->
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                                <h3 class="text-xl font-bold text-blue-800 mb-4">üéì Student Activities</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Student Clubs</p>
                                            <p class="text-sm text-gray-600">Technical, cultural, sports</p>
                                        </div>
                                        <span class="font-bold text-blue-600">‚Çπ18 L</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Events & Competitions</p>
                                            <p class="text-sm text-gray-600">Annual fest, hackathons</p>
                                        </div>
                                        <span class="font-bold text-blue-600">‚Çπ12 L</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">Student Welfare</p>
                                            <p class="text-sm text-gray-600">Scholarships, support</p>
                                        </div>
                                        <span class="font-bold text-blue-600">‚Çπ8 L</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Infrastructure & Operations -->
                        <div class="bg-gradient-to-br from-orange-50 to-yellow-50 rounded-xl p-6 border border-orange-200">
                            <h3 class="text-xl font-bold text-orange-800 mb-4">üèóÔ∏è Infrastructure & Operations</h3>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800">Campus Maintenance</p>
                                        <p class="text-sm text-gray-600">Buildings, utilities</p>
                                    </div>
                                    <span class="font-bold text-orange-600">‚Çπ25 L</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800">Technology Upgrades</p>
                                        <p class="text-sm text-gray-600">IT infrastructure</p>
                                    </div>
                                    <span class="font-bold text-orange-600">‚Çπ20 L</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800">Administrative</p>
                                        <p class="text-sm text-gray-600">Operations, staff</p>
                                    </div>
                                    <span class="font-bold text-orange-600">‚Çπ15 L</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- High-Level Visualization -->
                    <div class="bg-white rounded-xl card-shadow p-8 mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä Budget Overview & Trends</h2>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Annual Budget Distribution</h3>
                                <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                    <canvas id="citizenBudgetChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Quarterly Spending Trends</h3>
                                <div class="chart-placeholder h-64 rounded-lg flex items-center justify-center relative">
                                    <canvas id="citizenTrendChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Public Accountability Section -->
                    <div class="bg-white rounded-xl card-shadow p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üîç Public Accountability</h2>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">‚úÖ</span>
                                    <h4 class="font-semibold text-green-800">Audit Compliance</h4>
                                </div>
                                <p class="text-2xl font-bold text-green-600">98%</p>
                                <p class="text-sm text-gray-600">All financial records audited</p>
                            </div>
                            
                            <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">üìã</span>
                                    <h4 class="font-semibold text-blue-800">Public Reports</h4>
                                </div>
                                <p class="text-2xl font-bold text-blue-600">Monthly</p>
                                <p class="text-sm text-gray-600">Regular financial updates</p>
                            </div>
                            
                            <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">üéØ</span>
                                    <h4 class="font-semibold text-purple-800">Goal Achievement</h4>
                                </div>
                                <p class="text-2xl font-bold text-purple-600">92%</p>
                                <p class="text-sm text-gray-600">Budget targets met</p>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-6">
                            <h4 class="font-semibold mb-4 text-gray-800">üì¢ Recent Public Updates</h4>
                            <div class="space-y-3">
                                <div class="bg-white rounded-lg p-4 border-l-4 border-blue-500">
                                    <p class="font-medium text-gray-800">Q4 Financial Report Published</p>
                                    <p class="text-sm text-gray-600">Complete breakdown of departmental spending and achievements</p>
                                    <p class="text-xs text-gray-500 mt-1">Published 2 days ago</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 border-l-4 border-green-500">
                                    <p class="font-medium text-gray-800">New Infrastructure Projects Approved</p>
                                    <p class="text-sm text-gray-600">‚Çπ45 L allocated for campus modernization and lab upgrades</p>
                                    <p class="text-xs text-gray-500 mt-1">Published 1 week ago</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 border-l-4 border-purple-500">
                                    <p class="font-medium text-gray-800">Student Feedback Integration</p>
                                    <p class="text-sm text-gray-600">Budget adjustments made based on student voting results</p>
                                    <p class="text-xs text-gray-500 mt-1">Published 2 weeks ago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Initialize dashboard features after content is loaded
            setTimeout(() => {
                if (currentUserType === 'student') {
                    displayTransactions();
                    drawCharts();
                } else if (currentUserType === 'citizens') {
                    drawCitizenCharts();
                }
            }, 100);
        }

        function showVoting() {
            hideAllPages();
            document.getElementById('votingPage').classList.remove('hidden');
        }

        function vote(type) {
            if (userVotes[type]) {
                showPopup(`
                    <div class="text-center">
                        <div class="text-4xl mb-4 text-orange-500">‚ö†Ô∏è</div>
                        <h3 class="text-lg font-semibold mb-2">Already Voted</h3>
                        <p class="text-gray-600">You have already cast your vote for this item.</p>
                    </div>
                `);
                return;
            }

            userVotes[type] = true;
            const voteElement = document.getElementById(type + 'Votes');
            const totalVotesElement = document.getElementById('totalVotes');
            const currentVotes = parseInt(voteElement.textContent);
            const totalVotes = parseInt(totalVotesElement.textContent);
            
            voteElement.textContent = currentVotes + 1;
            totalVotesElement.textContent = totalVotes + 1;

            // Update progress bars
            updateVotingProgress();

            // Disable the button and change its appearance
            const buttons = document.querySelectorAll(`button[onclick="vote('${type}')"]`);
            buttons.forEach(button => {
                button.innerHTML = '‚úÖ Vote Recorded';
                button.classList.remove('hover:bg-blue-700', 'hover:bg-green-700', 'hover:scale-105');
                button.classList.add('bg-gray-400', 'cursor-not-allowed');
                button.onclick = null;
            });

            showPopup(`
                <div class="text-center">
                    <div class="text-4xl mb-4 text-success-green">üó≥Ô∏è</div>
                    <h3 class="text-lg font-semibold mb-2">Vote Successfully Recorded!</h3>
                    <p class="text-gray-600">Thank you for participating in the decision-making process!</p>
                    <div class="mt-4 p-3 bg-green-50 rounded-lg">
                        <p class="text-sm text-green-700">Your voice matters in shaping our institution's future.</p>
                    </div>
                </div>
            `);
        }

        function updateVotingProgress() {
            const deptVotes = parseInt(document.getElementById('deptFundingVotes').textContent);
            const clubVotes = parseInt(document.getElementById('clubFundingVotes').textContent);
            const total = deptVotes + clubVotes;
            
            const deptPercentage = Math.round((deptVotes / total) * 100);
            const clubPercentage = Math.round((clubVotes / total) * 100);
            
            // Update all progress bars
            const deptBars = document.querySelectorAll('.bg-blue-500');
            const clubBars = document.querySelectorAll('.bg-green-500');
            const deptLabels = document.querySelectorAll('.text-blue-600');
            const clubLabels = document.querySelectorAll('.text-green-600');
            
            deptBars.forEach(bar => {
                if (bar.parentElement.classList.contains('bg-blue-100') || bar.parentElement.classList.contains('bg-gray-200')) {
                    bar.style.width = deptPercentage + '%';
                }
            });
            
            clubBars.forEach(bar => {
                if (bar.parentElement.classList.contains('bg-green-100') || bar.parentElement.classList.contains('bg-gray-200')) {
                    bar.style.width = clubPercentage + '%';
                }
            });
            
            // Update percentage labels
            document.querySelectorAll('.text-blue-600').forEach(label => {
                if (label.textContent.includes('%')) {
                    label.textContent = deptPercentage + '%';
                }
            });
            
            document.querySelectorAll('.text-green-600').forEach(label => {
                if (label.textContent.includes('%')) {
                    label.textContent = clubPercentage + '%';
                }
            });
        }

        function logout() {
            currentUserType = '';
            userVotes = { funding: false, clubs: false };
            showLogin();
        }

        function hideAllPages() {
            const pages = ['loginPage', 'signUpPage', 'whoAreYouPage', 'verificationPage', 'studentInfoPage', 'dashboardPage', 'votingPage'];
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
        }

        function showPopup(content) {
            document.getElementById('popupContent').innerHTML = content;
            document.getElementById('popup').classList.remove('hidden');
        }

        function closePopup() {
            document.getElementById('popup').classList.add('hidden');
        }

        // New functionality functions
        function filterTransactions() {
            const searchTerm = document.getElementById('searchTransactions').value.toLowerCase();
            const deptFilter = document.getElementById('departmentFilter').value;
            const amountFilter = document.getElementById('amountFilter').value;

            filteredTransactions = allTransactions.filter(transaction => {
                const matchesSearch = transaction.department.toLowerCase().includes(searchTerm) || 
                                    transaction.vendor.toLowerCase().includes(searchTerm) ||
                                    transaction.description.toLowerCase().includes(searchTerm) ||
                                    transaction.recipient.toLowerCase().includes(searchTerm) ||
                                    transaction.approvedBy.toLowerCase().includes(searchTerm) ||
                                    transaction.purpose.toLowerCase().includes(searchTerm) ||
                                    transaction.paymentMode.toLowerCase().includes(searchTerm);
                
                const matchesDept = !deptFilter || transaction.department === deptFilter;
                
                let matchesAmount = true;
                if (amountFilter === 'low') matchesAmount = transaction.amount < 500000; // Under 5L
                else if (amountFilter === 'medium') matchesAmount = transaction.amount >= 500000 && transaction.amount <= 2000000; // 5L - 20L
                else if (amountFilter === 'high') matchesAmount = transaction.amount > 2000000; // Above 20L

                return matchesSearch && matchesDept && matchesAmount;
            });

            displayTransactions();
        }

        function displayTransactions() {
            const container = document.getElementById('transactionsList');
            if (!container) return;

            container.innerHTML = filteredTransactions.map(transaction => `
                <div class="bg-white rounded-xl p-6 border ${transaction.anomaly && anomalyDetectionEnabled ? 'border-red-300 bg-red-50' : 'border-gray-200'} card-shadow mb-4">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <h4 class="font-bold text-lg text-gray-800 mr-3">${transaction.vendor}</h4>
                                <span class="px-3 py-1 rounded-full text-xs font-medium ${transaction.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${transaction.status === 'completed' ? '‚úÖ Verified' : '‚è≥ Pending'}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <span class="font-medium">Department:</span> ${transaction.department}
                            </p>
                            <p class="text-sm text-gray-600 mb-1">
                                <span class="font-medium">Purpose:</span> ${transaction.purpose}
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-2xl ${transaction.anomaly && anomalyDetectionEnabled ? 'text-red-600' : 'text-primary-blue'} mb-1">
                                ${formatIndianCurrency(transaction.amount)}
                            </p>
                            ${transaction.anomaly && anomalyDetectionEnabled ? '<span class="text-xs text-red-500 font-medium">‚ö†Ô∏è ANOMALY</span>' : ''}
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm mb-2">
                                    <span class="font-medium text-gray-700">Recipient:</span><br>
                                    <span class="text-gray-600">${transaction.recipient}</span>
                                </p>
                                <p class="text-sm mb-2">
                                    <span class="font-medium text-gray-700">Approved By:</span><br>
                                    <span class="text-gray-600">${transaction.approvedBy}</span>
                                </p>
                            </div>
                            <div>
                                <p class="text-sm mb-2">
                                    <span class="font-medium text-gray-700">Payment Mode:</span>
                                    <span class="text-gray-600 ml-2">${transaction.paymentMode}</span>
                                </p>
                                <p class="text-sm mb-2">
                                    <span class="font-medium text-gray-700">Date & Time:</span>
                                    <span class="text-gray-600 ml-2">${transaction.date} at ${transaction.time}</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <p class="text-gray-700 text-sm flex-1 mr-4">
                            <span class="font-medium">Description:</span> ${transaction.description}
                        </p>
                        <div class="flex space-x-2">
                            <button onclick="showTransactionDetails(${transaction.id})" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg text-sm transition duration-300 font-medium">
                                üìã View Details
                            </button>
                            <button onclick="showFeedbackModal(${transaction.id})" class="bg-green-100 hover:bg-green-200 text-green-700 px-4 py-2 rounded-lg text-sm transition duration-300 font-medium">
                                üí≠ Feedback
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleAnomalyDetection() {
            anomalyDetectionEnabled = !anomalyDetectionEnabled;
            const btn = document.getElementById('anomalyBtn');
            const alertsSection = document.getElementById('anomalyAlerts');
            
            if (anomalyDetectionEnabled) {
                btn.textContent = 'ü™´ Disable Anomaly Detection';
                btn.classList.remove('bg-red-500', 'hover:bg-red-600');
                btn.classList.add('bg-green-500', 'hover:bg-green-600');
                alertsSection.classList.remove('hidden');
                showAnomalies();
            } else {
                btn.textContent = 'ü™´ Enable Anomaly Detection';
                btn.classList.remove('bg-green-500', 'hover:bg-green-600');
                btn.classList.add('bg-red-500', 'hover:bg-red-600');
                alertsSection.classList.add('hidden');
            }
            
            displayTransactions();
        }

        function showAnomalies() {
            const anomalies = allTransactions.filter(t => t.anomaly);
            const container = document.getElementById('anomalyList');
            
            container.innerHTML = anomalies.map(anomaly => `
                <div class="bg-white rounded-lg p-4 border border-red-300">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-semibold text-red-800">${anomaly.vendor} - ${anomaly.department}</h4>
                            <p class="text-sm text-red-600">Amount: ‚Çπ${anomaly.amount.toLocaleString()} ‚Ä¢ ${anomaly.date}</p>
                            <p class="text-xs text-gray-600 mt-1">Reason: Exceeds typical spending pattern by 150%</p>
                        </div>
                        <span class="text-2xl">üö®</span>
                    </div>
                </div>
            `).join('');
        }

        function showTransactionDetails(transactionId) {
            const transaction = allTransactions.find(t => t.id === transactionId);
            showPopup(`
                <div class="max-w-2xl">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">üìã Transaction Details</h3>
                    
                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm font-medium text-gray-700">Transaction ID</p>
                                <p class="text-gray-900">#TXN${transaction.id.toString().padStart(6, '0')}</p>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-700">Status</p>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${transaction.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${transaction.status === 'completed' ? '‚úÖ Completed & Verified' : '‚è≥ Pending Approval'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">Payment Information</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm font-medium text-gray-700">Amount</p>
                                    <p class="text-xl font-bold text-primary-blue">${formatIndianCurrency(transaction.amount)}</p>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-700">Payment Mode</p>
                                    <p class="text-gray-900">${transaction.paymentMode}</p>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-700">Date</p>
                                    <p class="text-gray-900">${transaction.date}</p>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-700">Time</p>
                                    <p class="text-gray-900">${transaction.time}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t pt-4 mt-4">
                            <h4 class="font-semibold mb-3">Authorization Details</h4>
                            <div class="space-y-2">
                                <div>
                                    <p class="text-sm font-medium text-gray-700">Recipient</p>
                                    <p class="text-gray-900">${transaction.recipient}</p>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-700">Approved By</p>
                                    <p class="text-gray-900">${transaction.approvedBy}</p>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-700">Department</p>
                                    <p class="text-gray-900">${transaction.department}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t pt-4 mt-4">
                            <h4 class="font-semibold mb-2">Purpose & Description</h4>
                            <p class="text-gray-700 mb-2">${transaction.purpose}</p>
                            <p class="text-sm text-gray-600">${transaction.description}</p>
                        </div>
                    </div>
                </div>
            `);
        }

        function showFeedbackModal(transactionId) {
            const transaction = allTransactions.find(t => t.id === transactionId);
            showPopup(`
                <h3 class="text-lg font-semibold mb-4">üí≠ Community Feedback</h3>
                <p class="text-sm text-gray-600 mb-4">Share your thoughts on: ${transaction.vendor} - ${transaction.description}</p>
                <textarea id="feedbackText" placeholder="Enter your feedback or suggestion..." 
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 h-24 resize-none"></textarea>
                <button onclick="submitFeedback(${transactionId})" class="w-full bg-primary-blue text-white py-2 px-4 rounded-lg mb-2">
                    Submit Feedback
                </button>
            `);
        }

        function submitFeedback(transactionId) {
            const feedback = document.getElementById('feedbackText').value;
            if (feedback.trim()) {
                showPopup(`
                    <div class="text-center">
                        <div class="text-4xl mb-4 text-success-green">‚úì</div>
                        <h3 class="text-lg font-semibold mb-2">Feedback Submitted</h3>
                        <p class="text-gray-600">Thank you for your input! Your feedback helps improve transparency.</p>
                    </div>
                `);
                setTimeout(closePopup, 2000);
            }
        }

        function drawCharts() {
            // Enhanced chart drawing using canvas
            const spendingCanvas = document.getElementById('spendingChart');
            const budgetCanvas = document.getElementById('budgetChart');
            
            if (spendingCanvas && spendingCanvas.getContext) {
                const ctx1 = spendingCanvas.getContext('2d');
                ctx1.clearRect(0, 0, 400, 200);
                
                // Draw grid lines
                ctx1.strokeStyle = '#e5e7eb';
                ctx1.lineWidth = 1;
                for (let i = 0; i <= 5; i++) {
                    const y = 30 + (i * 30);
                    ctx1.beginPath();
                    ctx1.moveTo(40, y);
                    ctx1.lineTo(380, y);
                    ctx1.stroke();
                }
                
                // Draw spending trend line with gradient
                const gradient = ctx1.createLinearGradient(0, 0, 0, 200);
                gradient.addColorStop(0, 'rgba(37, 99, 235, 0.8)');
                gradient.addColorStop(1, 'rgba(37, 99, 235, 0.2)');
                
                ctx1.strokeStyle = '#2563eb';
                ctx1.lineWidth = 4;
                ctx1.beginPath();
                const points = [120, 80, 95, 60, 85, 45, 70];
                const amounts = ['‚Çπ21 L', '‚Çπ28 L', '‚Çπ24 L', '‚Çπ32 L', '‚Çπ29 L', '‚Çπ35 L', '‚Çπ31 L'];
                
                points.forEach((point, index) => {
                    const x = 60 + (index * 45);
                    const y = point;
                    if (index === 0) ctx1.moveTo(x, y);
                    else ctx1.lineTo(x, y);
                    
                    // Draw data points
                    ctx1.save();
                    ctx1.fillStyle = '#2563eb';
                    ctx1.beginPath();
                    ctx1.arc(x, y, 5, 0, 2 * Math.PI);
                    ctx1.fill();
                    ctx1.restore();
                });
                ctx1.stroke();
                
                // Fill area under curve
                ctx1.lineTo(330, 180);
                ctx1.lineTo(60, 180);
                ctx1.closePath();
                ctx1.fillStyle = gradient;
                ctx1.fill();
                
                // Add labels and values
                ctx1.fillStyle = '#374151';
                ctx1.font = '11px sans-serif';
                ctx1.textAlign = 'center';
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'];
                months.forEach((month, index) => {
                    const x = 60 + (index * 45);
                    ctx1.fillText(month, x, 195);
                    // Add amount labels
                    ctx1.fillStyle = '#1f2937';
                    ctx1.font = 'bold 9px sans-serif';
                    ctx1.fillText(amounts[index], x, points[index] - 10);
                    ctx1.fillStyle = '#374151';
                    ctx1.font = '11px sans-serif';
                });
                
                // Add title
                ctx1.fillStyle = '#1f2937';
                ctx1.font = 'bold 14px sans-serif';
                ctx1.textAlign = 'left';
                ctx1.fillText('Monthly Spending Trends', 40, 20);
            }
            
            if (budgetCanvas && budgetCanvas.getContext) {
                const ctx2 = budgetCanvas.getContext('2d');
                ctx2.clearRect(0, 0, 400, 200);
                
                // Enhanced pie chart with shadows and gradients
                const centerX = 180, centerY = 100, radius = 70;
                const segments = [
                    { label: 'Computer Science', value: 35, color: '#2563eb', amount: '‚Çπ87.5 L' },
                    { label: 'Electronics', value: 25, color: '#10b981', amount: '‚Çπ62.5 L' },
                    { label: 'Mechanical', value: 20, color: '#f59e0b', amount: '‚Çπ50 L' },
                    { label: 'Civil', value: 20, color: '#ef4444', amount: '‚Çπ50 L' }
                ];
                
                let currentAngle = -Math.PI / 2; // Start from top
                
                segments.forEach((segment, index) => {
                    const sliceAngle = (segment.value / 100) * 2 * Math.PI;
                    
                    // Draw shadow
                    ctx2.save();
                    ctx2.translate(2, 2);
                    ctx2.beginPath();
                    ctx2.moveTo(centerX, centerY);
                    ctx2.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                    ctx2.closePath();
                    ctx2.fillStyle = 'rgba(0, 0, 0, 0.1)';
                    ctx2.fill();
                    ctx2.restore();
                    
                    // Draw main slice with gradient
                    const gradient = ctx2.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                    gradient.addColorStop(0, segment.color);
                    gradient.addColorStop(1, segment.color + '80');
                    
                    ctx2.beginPath();
                    ctx2.moveTo(centerX, centerY);
                    ctx2.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                    ctx2.closePath();
                    ctx2.fillStyle = gradient;
                    ctx2.fill();
                    
                    // Draw border
                    ctx2.strokeStyle = 'white';
                    ctx2.lineWidth = 2;
                    ctx2.stroke();
                    
                    // Add percentage labels
                    const labelAngle = currentAngle + sliceAngle / 2;
                    const labelX = centerX + Math.cos(labelAngle) * (radius * 0.6);
                    const labelY = centerY + Math.sin(labelAngle) * (radius * 0.6);
                    
                    ctx2.fillStyle = 'white';
                    ctx2.font = 'bold 12px sans-serif';
                    ctx2.textAlign = 'center';
                    ctx2.fillText(segment.value + '%', labelX, labelY);
                    
                    currentAngle += sliceAngle;
                });
                
                // Add legend
                segments.forEach((segment, index) => {
                    const legendY = 30 + (index * 25);
                    const legendX = 280;
                    
                    // Color box
                    ctx2.fillStyle = segment.color;
                    ctx2.fillRect(legendX, legendY - 8, 12, 12);
                    
                    // Text
                    ctx2.fillStyle = '#374151';
                    ctx2.font = '11px sans-serif';
                    ctx2.textAlign = 'left';
                    ctx2.fillText(segment.label.substring(0, 8) + '...', legendX + 18, legendY + 2);
                    
                    // Amount
                    ctx2.fillStyle = '#6b7280';
                    ctx2.font = '10px sans-serif';
                    ctx2.fillText(segment.amount, legendX + 18, legendY + 14);
                });
                
                // Add title
                ctx2.fillStyle = '#1f2937';
                ctx2.font = 'bold 14px sans-serif';
                ctx2.textAlign = 'left';
                ctx2.fillText('Budget Distribution', 20, 20);
            }
        }

        function drawCitizenCharts() {
            // Citizens-specific charts with high-level overview
            const budgetCanvas = document.getElementById('citizenBudgetChart');
            const trendCanvas = document.getElementById('citizenTrendChart');
            
            if (budgetCanvas && budgetCanvas.getContext) {
                const ctx1 = budgetCanvas.getContext('2d');
                ctx1.clearRect(0, 0, 400, 200);
                
                // Pie chart for overall budget distribution
                const centerX = 180, centerY = 100, radius = 70;
                const segments = [
                    { label: 'Academic Departments', value: 72, color: '#10b981', amount: '‚Çπ1.8 Cr' },
                    { label: 'Student Activities', value: 15, color: '#3b82f6', amount: '‚Çπ38 L' },
                    { label: 'Infrastructure', value: 13, color: '#f59e0b', amount: '‚Çπ32 L' }
                ];
                
                let currentAngle = -Math.PI / 2;
                
                segments.forEach((segment, index) => {
                    const sliceAngle = (segment.value / 100) * 2 * Math.PI;
                    
                    // Draw shadow
                    ctx1.save();
                    ctx1.translate(2, 2);
                    ctx1.beginPath();
                    ctx1.moveTo(centerX, centerY);
                    ctx1.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                    ctx1.closePath();
                    ctx1.fillStyle = 'rgba(0, 0, 0, 0.1)';
                    ctx1.fill();
                    ctx1.restore();
                    
                    // Draw main slice
                    const gradient = ctx1.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                    gradient.addColorStop(0, segment.color);
                    gradient.addColorStop(1, segment.color + '80');
                    
                    ctx1.beginPath();
                    ctx1.moveTo(centerX, centerY);
                    ctx1.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                    ctx1.closePath();
                    ctx1.fillStyle = gradient;
                    ctx1.fill();
                    
                    ctx1.strokeStyle = 'white';
                    ctx1.lineWidth = 2;
                    ctx1.stroke();
                    
                    // Add percentage labels
                    const labelAngle = currentAngle + sliceAngle / 2;
                    const labelX = centerX + Math.cos(labelAngle) * (radius * 0.6);
                    const labelY = centerY + Math.sin(labelAngle) * (radius * 0.6);
                    
                    ctx1.fillStyle = 'white';
                    ctx1.font = 'bold 12px sans-serif';
                    ctx1.textAlign = 'center';
                    ctx1.fillText(segment.value + '%', labelX, labelY);
                    
                    currentAngle += sliceAngle;
                });
                
                // Add legend
                segments.forEach((segment, index) => {
                    const legendY = 40 + (index * 30);
                    const legendX = 280;
                    
                    ctx1.fillStyle = segment.color;
                    ctx1.fillRect(legendX, legendY - 8, 12, 12);
                    
                    ctx1.fillStyle = '#374151';
                    ctx1.font = '10px sans-serif';
                    ctx1.textAlign = 'left';
                    ctx1.fillText(segment.label, legendX + 18, legendY + 2);
                    
                    ctx1.fillStyle = '#6b7280';
                    ctx1.font = 'bold 9px sans-serif';
                    ctx1.fillText(segment.amount, legendX + 18, legendY + 14);
                });
                
                ctx1.fillStyle = '#1f2937';
                ctx1.font = 'bold 14px sans-serif';
                ctx1.textAlign = 'left';
                ctx1.fillText('Annual Budget Overview', 20, 20);
            }
            
            if (trendCanvas && trendCanvas.getContext) {
                const ctx2 = trendCanvas.getContext('2d');
                ctx2.clearRect(0, 0, 400, 200);
                
                // Quarterly trend chart
                ctx2.strokeStyle = '#e5e7eb';
                ctx2.lineWidth = 1;
                for (let i = 0; i <= 4; i++) {
                    const y = 40 + (i * 30);
                    ctx2.beginPath();
                    ctx2.moveTo(50, y);
                    ctx2.lineTo(370, y);
                    ctx2.stroke();
                }
                
                // Draw trend line
                const gradient = ctx2.createLinearGradient(0, 0, 0, 200);
                gradient.addColorStop(0, 'rgba(16, 185, 129, 0.8)');
                gradient.addColorStop(1, 'rgba(16, 185, 129, 0.2)');
                
                ctx2.strokeStyle = '#10b981';
                ctx2.lineWidth = 4;
                ctx2.beginPath();
                
                const quarters = [80, 65, 70, 55];
                const amounts = ['‚Çπ58 L', '‚Çπ72 L', '‚Çπ65 L', '‚Çπ85 L'];
                
                quarters.forEach((point, index) => {
                    const x = 80 + (index * 80);
                    const y = point;
                    if (index === 0) ctx2.moveTo(x, y);
                    else ctx2.lineTo(x, y);
                    
                    // Draw data points
                    ctx2.save();
                    ctx2.fillStyle = '#10b981';
                    ctx2.beginPath();
                    ctx2.arc(x, y, 6, 0, 2 * Math.PI);
                    ctx2.fill();
                    ctx2.restore();
                });
                ctx2.stroke();
                
                // Fill area
                ctx2.lineTo(320, 160);
                ctx2.lineTo(80, 160);
                ctx2.closePath();
                ctx2.fillStyle = gradient;
                ctx2.fill();
                
                // Add labels
                ctx2.fillStyle = '#374151';
                ctx2.font = '11px sans-serif';
                ctx2.textAlign = 'center';
                const quarterLabels = ['Q1', 'Q2', 'Q3', 'Q4'];
                quarterLabels.forEach((quarter, index) => {
                    const x = 80 + (index * 80);
                    ctx2.fillText(quarter, x, 180);
                    
                    ctx2.fillStyle = '#1f2937';
                    ctx2.font = 'bold 9px sans-serif';
                    ctx2.fillText(amounts[index], x, quarters[index] - 12);
                    ctx2.fillStyle = '#374151';
                    ctx2.font = '11px sans-serif';
                });
                
                ctx2.fillStyle = '#1f2937';
                ctx2.font = 'bold 14px sans-serif';
                ctx2.textAlign = 'left';
                ctx2.fillText('Quarterly Spending Trends', 50, 25);
            }
        }

        function globalSearch() {
            const searchTerm = document.getElementById('dashboardSearch').value.toLowerCase().trim();
            
            // Clear any existing search result banners
            const existingBanners = document.querySelectorAll('.search-results-banner');
            existingBanners.forEach(banner => banner.remove());
            
            if (!searchTerm) {
                filteredTransactions = [...allTransactions];
                displayTransactions();
                return;
            }
            
            // Enhanced search that looks through all transaction fields
            filteredTransactions = allTransactions.filter(transaction => {
                const searchableFields = [
                    transaction.department,
                    transaction.vendor,
                    transaction.description,
                    transaction.recipient,
                    transaction.approvedBy,
                    transaction.purpose,
                    transaction.paymentMode,
                    transaction.status,
                    transaction.date,
                    transaction.time,
                    formatIndianCurrency(transaction.amount),
                    transaction.amount.toString(),
                    `#TXN${transaction.id.toString().padStart(6, '0')}` // Transaction ID
                ];
                
                return searchableFields.some(field => 
                    field && field.toLowerCase().includes(searchTerm)
                );
            });
            
            displayTransactions();
            
            // Show search results with enhanced feedback
            const resultsCount = filteredTransactions.length;
            const container = document.getElementById('transactionsList');
            
            if (container) {
                if (resultsCount === 0) {
                    container.innerHTML = `
                        <div class="search-results-banner bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
                            <div class="text-4xl mb-4">üîç</div>
                            <h3 class="text-lg font-semibold mb-2 text-yellow-800">No Results Found</h3>
                            <p class="text-yellow-700 mb-4">No transactions match "<span class="font-medium">${searchTerm}</span>"</p>
                            <div class="bg-white rounded-lg p-4 text-sm text-gray-600">
                                <p class="font-medium mb-2">Try searching by:</p>
                                <div class="grid grid-cols-2 gap-2 text-left">
                                    <p>‚Ä¢ Department (e.g., "Computer Science")</p>
                                    <p>‚Ä¢ Vendor (e.g., "Dell", "Microsoft")</p>
                                    <p>‚Ä¢ Amount (e.g., "25", "‚Çπ2.5")</p>
                                    <p>‚Ä¢ Status (e.g., "completed", "pending")</p>
                                    <p>‚Ä¢ Date (e.g., "2024-01-15")</p>
                                    <p>‚Ä¢ Transaction ID (e.g., "#TXN000001")</p>
                                </div>
                            </div>
                            <button onclick="clearSearch()" class="mt-4 bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition duration-300">
                                Clear Search
                            </button>
                        </div>
                    `;
                } else {
                    // Add search results banner at the top
                    const totalAmount = filteredTransactions.reduce((sum, t) => sum + t.amount, 0);
                    const completedCount = filteredTransactions.filter(t => t.status === 'completed').length;
                    const pendingCount = filteredTransactions.filter(t => t.status === 'pending').length;
                    
                    container.insertAdjacentHTML('afterbegin', `
                        <div class="search-results-banner bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <span class="text-blue-600 mr-3 text-xl">üîç</span>
                                    <div>
                                        <h4 class="text-blue-800 font-semibold">Search Results for "${searchTerm}"</h4>
                                        <p class="text-blue-600 text-sm">
                                            ${resultsCount} transaction${resultsCount > 1 ? 's' : ''} found ‚Ä¢ 
                                            Total: ${formatIndianCurrency(totalAmount)} ‚Ä¢ 
                                            ${completedCount} completed, ${pendingCount} pending
                                        </p>
                                    </div>
                                </div>
                                <button onclick="clearSearch()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition duration-300">
                                    Clear
                                </button>
                            </div>
                        </div>
                    `);
                }
            }
        }

        function clearSearch() {
            document.getElementById('dashboardSearch').value = '';
            filteredTransactions = [...allTransactions];
            displayTransactions();
            
            // Clear any existing search result banners
            const existingBanners = document.querySelectorAll('.search-results-banner');
            existingBanners.forEach(banner => banner.remove());
        }

        // Chatbot Functions
        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.classList.toggle('hidden');
            
            if (!chatWindow.classList.contains('hidden')) {
                document.getElementById('chatInput').focus();
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendChatMessage();
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addChatMessage(message, 'user');
            input.value = '';
            
            // Generate bot response
            setTimeout(() => {
                const response = generateBotResponse(message);
                addChatMessage(response, 'bot');
            }, 500);
        }

        function addChatMessage(message, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex items-start justify-end w-full">
                        <div class="bg-primary-blue text-white rounded-lg p-3 max-w-xs mr-2">
                            <p class="text-sm">${message}</p>
                        </div>
                        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-xs">üë§</span>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-primary-blue rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                        <span class="text-white text-xs">ü§ñ</span>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Store in chat history
            chatHistory.push({ message, sender, timestamp: new Date() });
        }

        function generateBotResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            // Budget-related queries
            if (message.includes('budget') || message.includes('money') || message.includes('funding')) {
                if (currentUserType === 'student') {
                    return "üìä Your department (Computer Science) has a budget of ‚Çπ24 L this semester. This includes ‚Çπ12 L for lab facilities, ‚Çπ8.5 L for faculty salaries, ‚Çπ2.5 L for infrastructure, and ‚Çπ1 L for research. Student clubs have ‚Çπ18 L combined budget. Would you like more specific details?";
                } else if (currentUserType === 'citizens') {
                    return "üèõÔ∏è The total public budget is ‚Çπ2.5 Cr annually. 72% goes to academic departments (‚Çπ1.8 Cr), 15% to student activities (‚Çπ38 L), and 13% to infrastructure (‚Çπ32 L). All spending is audited with 98% compliance rate.";
                } else {
                    return "üí∞ I can provide detailed budget breakdowns, spending patterns, and allocation information. What specific budget area would you like to know about?";
                }
            }
            
            // Voting-related queries
            if (message.includes('vote') || message.includes('voting') || message.includes('election')) {
                return "üó≥Ô∏è You can participate in budget voting! Currently, there are two active proposals: Department Funding (57% support, 247 votes) and Club Funding (43% support, 189 votes). Click the voting cards in your dashboard to cast your vote. Each user can vote once per proposal.";
            }
            
            // Search help
            if (message.includes('search') || message.includes('find') || message.includes('transaction')) {
                return "üîç You can search transactions by: Department names (Computer Science, Electronics), Vendor names (Dell, Microsoft), Amounts (‚Çπ25 L, 2500000), Status (completed, pending), Dates (2024-01-15), or Transaction IDs (#TXN000001). Use the search bar at the top or the detailed filters in the transaction section.";
            }
            
            // Anomaly detection
            if (message.includes('anomaly') || message.includes('suspicious') || message.includes('unusual')) {
                return "üö® Anomaly detection helps identify unusual spending patterns. When enabled, it flags transactions that exceed typical spending by 150% or more. Currently, there are 2 flagged transactions: Mechanical Dept (‚Çπ32 L) and Electronics Dept (‚Çπ42 L). Enable it using the red button in the transaction section.";
            }
            
            // Transparency and compliance
            if (message.includes('transparency') || message.includes('audit') || message.includes('compliance')) {
                return "‚úÖ Our transparency score is 95%! All transactions are publicly audited (98% compliance), with monthly financial reports published. Every transaction shows recipient, approver, payment mode, and detailed purpose. Citizens have access to high-level overviews while students/stakeholders see detailed breakdowns.";
            }
            
            // Feedback process
            if (message.includes('feedback') || message.includes('suggestion') || message.includes('complaint')) {
                return "üí≠ You can provide feedback through the green 'Feedback' button in the top navigation. Students can suggest budget improvements, report issues, or request new features. Stakeholders can provide investment feedback and governance suggestions. All feedback is reviewed and helps improve our platform.";
            }
            
            // User type specific help
            if (message.includes('student') && currentUserType === 'student') {
                return "üéì As a student, you can: View your department's budget breakdown, participate in voting for budget allocations, search all transactions, enable anomaly detection, provide feedback on spending, and track club funding. Your voice matters in shaping institutional finances!";
            }
            
            if (message.includes('stakeholder') && currentUserType === 'stakeholder') {
                return "üíº As a stakeholder, you have access to: Investment overview (‚Çπ45M total, 18.5% ROI), 24 active funded projects, detailed transaction analysis, voting participation, and comprehensive feedback options. You can track fund allocation and portfolio performance.";
            }
            
            // Department-specific queries
            if (message.includes('computer science') || message.includes('cs')) {
                return "üíª Computer Science Department: ‚Çπ24 L total budget. Recent transactions include ‚Çπ25 L for Dell lab equipment and ‚Çπ9.5 L for Microsoft licenses. Faculty: 12 professors, Lab facilities: 50 workstations, Research budget: ‚Çπ1 L for conferences and publications.";
            }
            
            if (message.includes('electronics') || message.includes('ece')) {
                return "‚ö° Electronics Department: Recent ‚Çπ18 L for Siemens components and ‚Çπ42 L pending for Texas Instruments processors. Focus on embedded systems lab and circuit design facilities.";
            }
            
            // General help and greetings
            if (message.includes('hello') || message.includes('hi') || message.includes('help')) {
                return `Hello! I'm here to help you navigate Fiscality. I can assist with budget information, transaction searches, voting processes, anomaly detection, and answer questions about financial transparency. What would you like to know?`;
            }
            
            // Default response with suggestions
            return "I'd be happy to help! I can provide information about: üí∞ Budget breakdowns, üó≥Ô∏è Voting processes, üîç Transaction searches, üö® Anomaly detection, ‚úÖ Transparency measures, üí≠ Feedback options. Try asking about any of these topics or use the quick action buttons below!";
        }

        // Simple Feedback Functions
        function openSimpleFeedbackModal() {
            document.getElementById('feedbackModal').classList.remove('hidden');
            document.getElementById('feedbackText').focus();
        }

        function submitSimpleFeedback() {
            const feedback = document.getElementById('feedbackText').value.trim();
            const email = document.getElementById('feedbackEmail').value.trim();
            
            if (!feedback) {
                showPopup(`
                    <div class="text-center">
                        <div class="text-4xl mb-4 text-red-500">‚ö†Ô∏è</div>
                        <h3 class="text-lg font-semibold mb-2">Missing Feedback</h3>
                        <p class="text-gray-600">Please enter your feedback before submitting.</p>
                    </div>
                `);
                return;
            }
            
            // Store feedback
            const feedbackData = {
                id: feedbackSubmissions.length + 1,
                feedback,
                email,
                userType: currentUserType,
                timestamp: new Date(),
                status: 'submitted'
            };
            
            feedbackSubmissions.push(feedbackData);
            
            // Clear form
            document.getElementById('feedbackText').value = '';
            document.getElementById('feedbackEmail').value = '';
            
            // Show success message
            showPopup(`
                <div class="text-center">
                    <div class="text-4xl mb-4 text-success-green">‚úÖ</div>
                    <h3 class="text-lg font-semibold mb-2">Feedback Submitted!</h3>
                    <p class="text-gray-600 mb-4">Thank you for your valuable input. Your feedback helps us improve Fiscality for everyone.</p>
                    <div class="bg-green-50 rounded-lg p-4 text-left">
                        <p class="text-sm text-green-700 mb-1"><strong>Feedback ID:</strong> #FB${feedbackData.id.toString().padStart(4, '0')}</p>
                        <p class="text-sm text-green-700 mb-1"><strong>Status:</strong> Under Review</p>
                        <p class="text-sm text-green-700"><strong>Submitted:</strong> ${new Date().toLocaleString()}</p>
                    </div>
                </div>
            `);
            
            closeFeedbackModal();
        }

        function closeFeedbackModal() {
            document.getElementById('feedbackModal').classList.add('hidden');
        }

        function showFeedbackForm(category) {
            const content = document.getElementById('feedbackContent');
            const categoryTitles = {
                budget: 'üí∞ Budget Allocation Feedback',
                platform: 'üíª Platform Features Feedback',
                transparency: 'üîç Transparency Feedback',
                general: 'üí≠ General Feedback',
                investment: 'üìà Investment Performance Feedback',
                governance: 'üèõÔ∏è Governance Feedback',
                reporting: 'üìä Financial Reporting Feedback',
                strategic: 'üéØ Strategic Direction Feedback'
            };
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="flex items-center">
                        <button onclick="openFeedbackModal()" class="text-gray-500 hover:text-gray-700 mr-4">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <h4 class="text-xl font-semibold text-gray-800">${categoryTitles[category]}</h4>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                            <select id="feedbackPriority" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                                <option value="low">Low - General suggestion</option>
                                <option value="medium">Medium - Important improvement</option>
                                <option value="high">High - Critical issue</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                            <input type="text" id="feedbackSubject" placeholder="Brief description of your feedback..." 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Detailed Feedback</label>
                            <textarea id="feedbackDetails" rows="6" placeholder="Please provide detailed feedback, suggestions, or report any issues..." 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Contact Information (Optional)</label>
                            <input type="email" id="feedbackEmail" placeholder="your.email@example.com" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent outline-none">
                            <p class="text-xs text-gray-500 mt-1">We'll only use this to follow up on your feedback if needed</p>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="submitFeedback('${category}')" class="flex-1 bg-primary-blue hover:bg-blue-700 text-white py-3 px-6 rounded-lg transition duration-300 font-medium">
                                üì§ Submit Feedback
                            </button>
                            <button onclick="openFeedbackModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function submitFeedback(category) {
            const priority = document.getElementById('feedbackPriority').value;
            const subject = document.getElementById('feedbackSubject').value;
            const details = document.getElementById('feedbackDetails').value;
            const email = document.getElementById('feedbackEmail').value;
            
            if (!subject.trim() || !details.trim()) {
                showPopup(`
                    <div class="text-center">
                        <div class="text-4xl mb-4 text-red-500">‚ö†Ô∏è</div>
                        <h3 class="text-lg font-semibold mb-2">Incomplete Feedback</h3>
                        <p class="text-gray-600">Please provide both a subject and detailed feedback.</p>
                    </div>
                `);
                return;
            }
            
            // Store feedback
            const feedback = {
                id: feedbackSubmissions.length + 1,
                category,
                priority,
                subject,
                details,
                email,
                userType: currentUserType,
                timestamp: new Date(),
                status: 'submitted'
            };
            
            feedbackSubmissions.push(feedback);
            
            // Show success message
            showPopup(`
                <div class="text-center">
                    <div class="text-4xl mb-4 text-success-green">‚úÖ</div>
                    <h3 class="text-lg font-semibold mb-2">Feedback Submitted Successfully!</h3>
                    <p class="text-gray-600 mb-4">Thank you for your valuable input. Your feedback helps us improve Fiscality.</p>
                    <div class="bg-green-50 rounded-lg p-4 text-left">
                        <p class="text-sm text-green-700 mb-2"><strong>Feedback ID:</strong> #FB${feedback.id.toString().padStart(4, '0')}</p>
                        <p class="text-sm text-green-700 mb-2"><strong>Category:</strong> ${category}</p>
                        <p class="text-sm text-green-700 mb-2"><strong>Priority:</strong> ${priority}</p>
                        <p class="text-sm text-green-700"><strong>Status:</strong> Under Review</p>
                    </div>
                </div>
            `);
            
            closeFeedbackModal();
        }

        function closeFeedbackModal() {
            document.getElementById('feedbackModal').classList.add('hidden');
        }

        // Initialize the application
        showLogin();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ea09fcd4748a2a',t:'MTc1Nzc5MTYxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
